# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Digital Twin —Å–∏—Å—Ç–µ–º—ã

> **–í–µ—Ä—Å–∏—è:** 1.0  
> **–î–∞—Ç–∞:** 31.12.2024  
> **–°—Ç–∞—Ç—É—Å:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ

---

## 1. –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1.1. –ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

1. **GUID –∫–∞–∫ —Å–≤—è–∑—É—é—â–µ–µ –∑–≤–µ–Ω–æ**
   - –ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç BIM –º–æ–¥–µ–ª–∏ –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π GUID
   - –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–∏—Å—Ç–µ–º–µ —Å–≤—è–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ GUID
   - GUID —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏ –º–æ–¥–µ–ª–∏

2. **–ï–¥–∏–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Single Source of Truth)**
   - PostgreSQL —Ö—Ä–∞–Ω–∏—Ç –í–°–ï —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –û–¥–Ω–∞ –±–∞–∑–∞ `structura` –¥–ª—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
   - –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

3. **API-First –ø–æ–¥—Ö–æ–¥**
   - PostgreSQL ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ REST API (PostgREST)
   - Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ API
   - –ù–∏–∫–∞–∫–æ–≥–æ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î –∏–∑ UI

4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–≥–æ –∏ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**
   - PostgreSQL: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–∞–±–ª–∏—Ü—ã, —Å–≤—è–∑–∏)
   - Nextcloud: —Ñ–∞–π–ª—ã (PDF, Excel, —Ñ–æ—Ç–æ)
   - –í –ë–î —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º

5. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ File Processor**
   - –§–∞–π–ª—ã –Ω–µ –≤–≤–æ–¥—è—Ç—Å—è –≤—Ä—É—á–Ω—É—é
   - Worker –ø–∞—Ä—Å–∏—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã ‚Üí –ø–∏—à–µ—Ç –≤ –ë–î
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –¥–æ–ø–æ–ª–Ω—è–µ—Ç

---

## 2. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ (—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–π)

### 2.1. –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PRESENTATION LAYER                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Refine.dev (React Framework)                               ‚îÇ
‚îÇ  ‚îú‚îÄ React 18                                                ‚îÇ
‚îÇ  ‚îú‚îÄ Ant Design 5 (UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)              ‚îÇ
‚îÇ  ‚îú‚îÄ Speckle Viewer SDK 2.17+ (BIM –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)             ‚îÇ
‚îÇ  ‚îî‚îÄ TypeScript                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì HTTP/REST
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      API LAYER                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  PostgREST v11                                              ‚îÇ
‚îÇ  ‚îî‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è REST API –∏–∑ —Å—Ö–µ–º—ã PostgreSQL   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì SQL
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    DATA LAYER                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  PostgreSQL 15-alpine                                       ‚îÇ
‚îÇ  ‚îú‚îÄ –ë–∞–∑–∞: speckle (–¥–ª—è Speckle Server)                      ‚îÇ
‚îÇ  ‚îî‚îÄ –ë–∞–∑–∞: structura (–¥–ª—è Digital Twin —Å–∏—Å—Ç–µ–º—ã)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üë                          ‚Üë                    ‚Üë
         ‚îÇ                          ‚îÇ                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Speckle Server ‚îÇ    ‚îÇ  File Processor    ‚îÇ  ‚îÇ    Grafana      ‚îÇ
‚îÇ  (BIM –º–æ–¥–µ–ª–∏)   ‚îÇ    ‚îÇ  (Python Worker)   ‚îÇ  ‚îÇ  (–î–∞—à–±–æ—Ä–¥—ã)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  MinIO (S3)     ‚îÇ    ‚îÇ   Nextcloud        ‚îÇ
‚îÇ  Blob storage   ‚îÇ    ‚îÇ   –§–∞–π–ª–æ–≤–æ–µ         ‚îÇ
‚îÇ  –¥–ª—è –≥–µ–æ–º–µ—Ç—Ä–∏–∏  ‚îÇ    ‚îÇ   —Ö—Ä–∞–Ω–∏–ª–∏—â–µ        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Redis          ‚îÇ
‚îÇ  Cache          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2.2. –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í—ã–±—Ä–∞–Ω–Ω–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ü–æ—á–µ–º—É –≤—ã–±—Ä–∞–ª–∏ | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã |
|-----------|---------------------|----------------|--------------|
| **Frontend** | Refine.dev | –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è CRUD, –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ, –±—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ | Custom React, Next.js |
| **UI Library** | Ant Design 5 | –†—É—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–∑ –∫–æ—Ä–æ–±–∫–∏, –±–æ–≥–∞—Ç—ã–π –Ω–∞–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, enterprise-ready | Material UI, Chakra UI |
| **API** | PostgREST | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ REST API –∏–∑ PostgreSQL, –Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å backend –≤—Ä—É—á–Ω—É—é | FastAPI (Python), Express (Node.js) |
| **Database** | PostgreSQL 15 | –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –ë–î, ACID, –º–æ—â–Ω—ã–π SQL, JSON –ø–æ–¥–¥–µ—Ä–∂–∫–∞, triggers/views | MySQL, MongoDB |
| **BIM Server** | Speckle | Open-source, –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π, SDK –¥–ª—è Viewer, REST API | BIMserver (—É—Å—Ç–∞—Ä–µ–ª), Xeokit |
| **File Storage** | Nextcloud | WebDAV API, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏, –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, self-hosted | MinIO, S3, –ª–æ–∫–∞–ª—å–Ω–∞—è –§–° |
| **File Processing** | Python 3.11 | pandas –¥–ª—è Excel, pdfplumber –¥–ª—è PDF, OCR, asyncio | Node.js (—Ö—É–∂–µ –¥–ª—è data science) |
| **Cache** | Redis | –ë—ã—Å—Ç—Ä—ã–π key-value store, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Speckle/Nextcloud | Memcached |
| **Reverse Proxy** | Traefik v2 | Auto SSL (Let's Encrypt), Docker labels –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | Nginx, Caddy |
| **Analytics** | Grafana | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL, –≥–æ—Ç–æ–≤—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ | Metabase, Apache Superset |

---

## 3. –î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 3.1. PostgreSQL - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

**–†–æ–ª—å:** Single Source of Truth –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–§–∏–∑–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ:**
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `postgres_speckle`
- Image: `postgres:15-alpine`
- Volumes: `../data/postgres_speckle:/var/lib/postgresql/data`

**–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```
postgres_speckle (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
‚îú‚îÄ postgres (system)
‚îú‚îÄ speckle        ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Speckle Server (–Ω–µ —Ç—Ä–æ–≥–∞–µ–º)
‚îî‚îÄ structura      ‚Üê –Ω–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ (–≤—Å–µ –º–æ–¥—É–ª–∏)
```

**–ü–æ—á–µ–º—É –µ–¥–∏–Ω–∞—è –ë–î:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- JOIN –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞—Ç–∏–≤–Ω–æ
- –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ü—Ä–æ—â–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–æ–¥–∏–Ω backup)

**–°–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:**
```
PostgreSQL
‚îú‚îÄ‚Üí Speckle Server (—á–∏—Ç–∞–µ—Ç/–ø–∏—à–µ—Ç –≤ `speckle`)
‚îú‚îÄ‚Üí PostgREST (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç API –∏–∑ `structura`)
‚îú‚îÄ‚Üí File Processor (–ø–∏—à–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞)
‚îú‚îÄ‚Üí Grafana (—á–∏—Ç–∞–µ—Ç –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤)
‚îî‚îÄ‚Üí pgAdmin (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
```

**–í–∞–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:**
```sql
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";  -- –≥–µ–Ω–µ—Ä–∞—Ü–∏—è UUID
CREATE EXTENSION IF NOT EXISTS "pg_trgm";     -- –Ω–µ—á–µ—Ç–∫–∏–π –ø–æ–∏—Å–∫
CREATE EXTENSION IF NOT EXISTS "postgis";     -- –≥–µ–æ–¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

---

### 3.2. PostgREST - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π REST API

**–†–æ–ª—å:** –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å—Ö–µ–º—É PostgreSQL –≤ REST API –±–µ–∑ –Ω–∞–ø–∏—Å–∞–Ω–∏—è backend –∫–æ–¥–∞

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**

```sql
-- –®–∞–≥ 1: –í—ã —Å–æ–∑–¥–∞–µ—Ç–µ —Ç–∞–±–ª–∏—Ü—É –≤ PostgreSQL
CREATE TABLE elements (
    guid VARCHAR(100) PRIMARY KEY,
    element_type VARCHAR(50),
    material VARCHAR(100)
);

-- –®–∞–≥ 2: PostgREST –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç endpoints:
-- GET    /elements                 -- —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
-- GET    /elements?guid=eq.abc123  -- –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
-- POST   /elements                 -- —Å–æ–∑–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç
-- PATCH  /elements?guid=eq.abc123  -- –æ–±–Ω–æ–≤–∏—Ç—å
-- DELETE /elements?guid=eq.abc123  -- —É–¥–∞–ª–∏—Ç—å

-- –®–∞–≥ 3: JOIN —á–µ—Ä–µ–∑ URL
-- GET /elements?select=*,zones(*)  -- —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∏—Ö –∑–∞—Ö–≤–∞—Ç–∫–∞–º–∏
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (docker-compose):**
```yaml
postgrest:
  image: postgrest/postgrest:v11
  environment:
    PGRST_DB_URI: postgres://speckle:password@postgres_speckle:5432/structura
    PGRST_DB_ANON_ROLE: web_anon   # —Ä–æ–ª—å –¥–ª—è —á—Ç–µ–Ω–∏—è
    PGRST_DB_SCHEMA: public
    PGRST_OPENAPI_SERVER_PROXY_URI: http://localhost:3001
  ports:
    - "3001:3000"
  depends_on:
    - postgres_speckle
```

**–†–æ–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
```sql
-- –ê–Ω–æ–Ω–∏–º–Ω–∞—è —Ä–æ–ª—å (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
CREATE ROLE web_anon NOLOGIN;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO web_anon;

-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–æ–ª—å (CRUD)
CREATE ROLE web_user NOLOGIN;
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO web_user;
```

**–ü–æ—á–µ–º—É PostgREST, –∞ –Ω–µ FastAPI/Express:**
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –∫–æ–¥ –≤—Ä—É—á–Ω—É—é (—ç–∫–æ–Ω–æ–º–∏—è 2-3 –Ω–µ–¥–µ–ª—å)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ API –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã –ë–î
- ‚úÖ –ú–æ—â–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JOIN —á–µ—Ä–µ–∑ URL
- ‚úÖ OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ùå –ù–µ—Ç –∫–∞—Å—Ç–æ–º–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (—Ç–æ–ª—å–∫–æ CRUD)
- ‚ùå –î–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ –Ω—É–∂–Ω—ã PostgreSQL Functions

**–†–µ—à–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π - PostgreSQL RPC:**
```sql
-- –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤ PostgreSQL
CREATE FUNCTION get_elements_with_acts()
RETURNS TABLE (guid VARCHAR(100), act_status VARCHAR(20))
AS $$
  SELECT e.guid, a.status
  FROM elements e
  LEFT JOIN aid_act_elements aae ON e.guid = aae.element_guid
  LEFT JOIN aid_acts a ON aae.act_id = a.id;
$$ LANGUAGE SQL STABLE;

-- PostgREST –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç endpoint:
-- POST /rpc/get_elements_with_acts
```

---

### 3.3. Refine.dev - Frontend Framework

**–†–æ–ª—å:** UI –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ (—Ñ–æ—Ä–º—ã, —Ç–∞–±–ª–∏—Ü—ã, BIM Viewer)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Refine –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```
src/
‚îú‚îÄ App.tsx                (–≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Refine)
‚îú‚îÄ pages/
‚îÇ  ‚îú‚îÄ login/              (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
‚îÇ  ‚îú‚îÄ dashboard/          (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
‚îÇ  ‚îú‚îÄ elements/           (–ø—Ä–æ—Å–º–æ—Ç—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–æ–¥–µ–ª–∏)
‚îÇ  ‚îú‚îÄ bim-viewer/         (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π BIM Viewer)
‚îÇ  ‚îî‚îÄ [resource]/         (–∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ CRUD —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
‚îú‚îÄ components/
‚îÇ  ‚îú‚îÄ BIMViewer.tsx       (Speckle Viewer –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
‚îÇ  ‚îú‚îÄ FileUploader.tsx    (–∑–∞–≥—Ä—É–∑–∫–∞ –≤ Nextcloud)
‚îÇ  ‚îî‚îÄ ...
‚îú‚îÄ providers/
‚îÇ  ‚îú‚îÄ dataProvider.ts     (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgREST)
‚îÇ  ‚îú‚îÄ authProvider.ts     (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
‚îÇ  ‚îî‚îÄ i18nProvider.ts     (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)
‚îî‚îÄ utils/
   ‚îú‚îÄ speckleClient.ts    (—Ä–∞–±–æ—Ç–∞ —Å Speckle API)
   ‚îî‚îÄ nextcloudClient.ts  (WebDAV –∫–ª–∏–µ–Ω—Ç)
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Data Provider (PostgREST):**
```typescript
import { dataProvider } from "@refinedev/simple-rest";

const API_URL = "http://localhost:3001";

const customDataProvider = {
  ...dataProvider(API_URL),
  
  // –ö–∞—Å—Ç–æ–º–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è JOIN
  getList: async ({ resource, filters }) => {
    const url = `${API_URL}/${resource}?select=*,related(*)`;
    const response = await fetch(url);
    return { data: await response.json() };
  }
};
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Speckle Viewer:**
```typescript
import { Viewer } from "@speckle/viewer";

const BIMViewer: React.FC = () => {
  const containerRef = useRef<HTMLDivElement>(null);
  const [viewer, setViewer] = useState<Viewer | null>(null);

  useEffect(() => {
    if (!containerRef.current) return;
    
    const v = new Viewer({
      container: containerRef.current,
      showStats: true
    });
    setViewer(v);

    return () => v.dispose();
  }, []);

  const loadModel = async (url: string) => {
    await viewer?.loadObject(url);
  };

  return <div ref={containerRef} style={{ width: '100%', height: '600px' }} />;
};
```

**–†—É—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (i18nProvider):**
```typescript
import { I18nProvider } from "@refinedev/core";

const i18nProvider: I18nProvider = {
  translate: (key, options) => {
    const translations = {
      "buttons.create": "–°–æ–∑–¥–∞—Ç—å",
      "buttons.save": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
      "buttons.cancel": "–û—Ç–º–µ–Ω–∞",
      "pages.login.title": "–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É",
      // ... –≤—Å–µ –ø–µ—Ä–µ–≤–æ–¥—ã
    };
    return translations[key] || key;
  },
  changeLocale: (lang) => Promise.resolve(),
  getLocale: () => "ru",
};
```

**–°–≤—è–∑—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ Refine:**
```
Refine App
‚îú‚îÄ‚Üí PostgREST (dataProvider)
‚îÇ   ‚îî‚îÄ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ (GET/POST/PATCH/DELETE)
‚îÇ
‚îú‚îÄ‚Üí Speckle API (–ø—Ä—è–º–æ–π fetch)
‚îÇ   ‚îî‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ BIM –º–æ–¥–µ–ª–∏ –≤ Viewer
‚îÇ
‚îî‚îÄ‚Üí Nextcloud WebDAV (webdav –±–∏–±–ª–∏–æ—Ç–µ–∫–∞)
    ‚îî‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞/—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
```

---

### 3.4. Speckle Server - BIM Platform

**–†–æ–ª—å:** –•—Ä–∞–Ω–∏–ª–∏—â–µ BIM –º–æ–¥–µ–ª–µ–π, –∏—Å—Ç–æ—á–Ω–∏–∫ GUID, –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Speckle (–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã):**
```
Speckle Platform
‚îú‚îÄ speckle-server         (–≥–ª–∞–≤–Ω—ã–π API, GraphQL)
‚îú‚îÄ speckle-frontend       (Web UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–æ–¥–µ–ª–µ–π)
‚îú‚îÄ speckle-preview        (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—å—é)
‚îú‚îÄ speckle-webhook        (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö)
‚îî‚îÄ speckle-fileimport     (–∑–∞–≥—Ä—É–∑–∫–∞ IFC —Ñ–∞–π–ª–æ–≤)
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Speckle:**
```
Speckle Server
‚îú‚îÄ‚Üí PostgreSQL (–±–∞–∑–∞ `speckle`)
‚îÇ   ‚îî‚îÄ –ü—Ä–æ–µ–∫—Ç—ã, –∫–æ–º–º–∏—Ç—ã, –æ–±—ä–µ–∫—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ
‚îú‚îÄ‚Üí MinIO (S3 –ø—Ä–æ—Ç–æ–∫–æ–ª)
‚îÇ   ‚îî‚îÄ Blob –¥–∞–Ω–Ω—ã–µ (–≥–µ–æ–º–µ—Ç—Ä–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
‚îÇ
‚îî‚îÄ‚Üí Redis
    ‚îî‚îÄ –ö–µ—à –∑–∞–ø—Ä–æ—Å–æ–≤
```

**–ö–∞–∫ Speckle —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ:**

```
–ü—Ä–æ–µ–∫—Ç –≤ Speckle:
‚îú‚îÄ Stream (–ø—Ä–æ–µ–∫—Ç)
‚îÇ  ‚îú‚îÄ Branch (–Ω–∞–ø—Ä–∏–º–µ—Ä, "main")
‚îÇ  ‚îÇ  ‚îú‚îÄ Commit 1 (–≤–µ—Ä—Å–∏—è –æ—Ç 01.01.2025)
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ Object Tree (—ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–µ–ª–∏ —Å GUID)
‚îÇ  ‚îÇ  ‚îú‚îÄ Commit 2 (–≤–µ—Ä—Å–∏—è –æ—Ç 15.01.2025)
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ Object Tree
‚îÇ  ‚îî‚îÄ Branch ("design-option-2")
```

**–ö–∞–∫ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Speckle:**

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ (IFC):**
   ```
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Speckle Frontend ‚Üí Upload IFC
                                          ‚Üì
                        speckle-fileimport —Å–µ—Ä–≤–∏—Å –ø–∞—Ä—Å–∏—Ç IFC
                                          ‚Üì
                        –°–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–º–º–∏—Ç —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
                                          ‚Üì
                        –ì–µ–æ–º–µ—Ç—Ä–∏—è ‚Üí MinIO (S3)
                        –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ ‚Üí PostgreSQL
   ```

2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ GUID –¥–ª—è –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã:**
   ```python
   from specklepy.api.client import SpeckleClient
   
   client = SpeckleClient(host="http://speckle.structura-most.ru")
   client.authenticate_with_token("your_token")
   
   # –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç
   commit = client.commit.get(stream_id, commit_id)
   
   # –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã
   objects = client.object.get(commit.referencedObject)
   
   # –û–±—Ö–æ–¥ –¥–µ—Ä–µ–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   for element in walk_tree(objects):
       guid = element.applicationId  # GUID –∏–∑ Tekla/Revit
       
       # –ó–∞–ø–∏—Å–∞—Ç—å –≤ PostgreSQL (structura)
       conn.execute("""
           INSERT INTO elements (guid, element_type, material)
           VALUES (%s, %s, %s)
       """, (guid, element.speckle_type, element.material))
   ```

3. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Refine Viewer:**
   ```typescript
   const modelUrl = `https://speckle.structura-most.ru/projects/${projectId}/models/${modelId}`;
   await viewer.loadObject(modelUrl);
   ```

**–í–∞–∂–Ω–æ:**
- Speckle —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –≥–µ–æ–º–µ—Ç—Ä–∏—é –∏ –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –í—Å–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∞–∫—Ç—ã, –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –∑–∞–¥–∞–Ω–∏—è) ‚Üí PostgreSQL (structura)
- –°–≤—è–∑—å —á–µ—Ä–µ–∑ GUID

---

### 3.5. Nextcloud - File Storage

**–†–æ–ª—å:** –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤ (PDF, Excel, —Ñ–æ—Ç–æ)

**–ü–æ—á–µ–º—É Nextcloud, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ MinIO –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –§–°:**
- ‚úÖ WebDAV API (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª)
- ‚úÖ Web UI –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º —Å –ø–ª–∞–Ω—à–µ—Ç–∞)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –≥—Ä—É–ø–ø—ã)
- ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è:**
```
/–ü—Ä–æ–µ–∫—Ç—ã/
  /–ú–ì–£/
    /–ê–∫—Ç—ã/               ‚Üê PDF –∞–∫—Ç–æ–≤ –ê–ò–î
    /–ö–°-2/               ‚Üê PDF –ö–°-2
    /–°–º–µ—Ç—ã/              ‚Üê Excel —Å–º–µ—Ç—ã
    /–†–î/                 ‚Üê –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ Tekla
    /–§–æ—Ç–æ/               ‚Üê –§–æ—Ç–æ—Ñ–∏–∫—Å–∞—Ü–∏—è
    /–°–º–µ–Ω–Ω—ã–µ_–∑–∞–¥–∞–Ω–∏—è/    ‚Üê –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ PDF –∑–∞–¥–∞–Ω–∏–π
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PostgreSQL:**
```sql
-- –í —Ç–∞–±–ª–∏—Ü–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
CREATE TABLE aid_acts (
    id SERIAL PRIMARY KEY,
    act_number VARCHAR(50),
    pdf_file_path VARCHAR(500),  ‚Üê "/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–ê–∫—Ç—ã/–ê–∫—Ç_001.pdf"
    ...
);
```

**WebDAV API (–ø—Ä–∏–º–µ—Ä—ã):**

```typescript
// Refine Frontend
import { createClient } from "webdav";

const client = createClient("https://cloud.structura-most.ru/remote.php/dav", {
  username: "user",
  password: "pass"
});

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
await client.putFileContents("/files/user/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–ê–∫—Ç—ã/–ê–∫—Ç_001.pdf", pdfBuffer);

// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
const buffer = await client.getFileContents("/files/user/...");

// –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ
const files = await client.getDirectoryContents("/files/user/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–ê–∫—Ç—ã");
```

```python
# File Processor (Python)
from webdav3.client import Client

client = Client({
    'webdav_hostname': "https://cloud.structura-most.ru/remote.php/dav",
    'webdav_login': "admin",
    'webdav_password': "password"
})

# –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
client.download_file(
    remote_path="/files/admin/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–°–º–µ—Ç—ã/–°–º–µ—Ç–∞.xlsx",
    local_path="/tmp/smeta.xlsx"
)
```

---

### 3.6. File Processor - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤

**–†–æ–ª—å:** –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ –∏–∑ Nextcloud ‚Üí –∑–∞–ø–∏—Å—å –≤ PostgreSQL

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Worker:**
```
File Processor (Python)
‚îú‚îÄ worker.py           (–≥–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç, —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚îú‚îÄ parsers/
‚îÇ  ‚îú‚îÄ excel_parser.py  (pandas –¥–ª—è Excel)
‚îÇ  ‚îú‚îÄ pdf_parser.py    (pdfplumber + OCR)
‚îÇ  ‚îî‚îÄ csv_parser.py    (1–° –≤—ã–≥—Ä—É–∑–∫–∏)
‚îú‚îÄ utils/
‚îÇ  ‚îú‚îÄ nextcloud.py     (WebDAV –∫–ª–∏–µ–Ω—Ç)
‚îÇ  ‚îî‚îÄ database.py      (PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
‚îî‚îÄ requirements.txt
```

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**

```python
# worker.py
import schedule
import time

def scan_and_process():
    folders = {
        '/files/admin/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–ê–∫—Ç—ã': 'pdf',
        '/files/admin/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–°–º–µ—Ç—ã': 'excel',
        '/files/admin/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/1C': 'csv'
    }
    
    for folder, file_type in folders.items():
        files = nextcloud_client.list(folder)
        
        for file_info in files:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ª–∏ —Ñ–∞–π–ª
            if is_already_processed(file_info['path']):
                continue
            
            # –°–∫–∞—á–∏–≤–∞–µ–º
            local_path = download_file(file_info['path'])
            
            # –ü–∞—Ä—Å–∏–º
            if file_type == 'excel':
                data = parse_excel(local_path)
            elif file_type == 'pdf':
                data = parse_pdf(local_path)
            
            # –ü–∏—à–µ–º –≤ –ë–î (—á–µ—Ä–Ω–æ–≤–∏–∫–∏)
            write_to_database(data, needs_review=True)
            
            # –õ–æ–≥–∏—Ä—É–µ–º
            log_processed_file(file_info['path'])

# –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
schedule.every(5).minutes.do(scan_and_process)

while True:
    schedule.run_pending()
    time.sleep(1)
```

**–ü–∞—Ä—Å–µ—Ä—ã:**

```python
# parsers/excel_parser.py
import pandas as pd

def parse_estimate_excel(file_path):
    """–ü–∞—Ä—Å–∏–Ω–≥ —Å–º–µ—Ç—ã"""
    df = pd.read_excel(file_path, sheet_name='–ú–∞—Ç–µ—Ä–∏–∞–ª—ã')
    
    results = []
    for _, row in df.iterrows():
        results.append({
            'material_name': row['–ú–∞—Ç–µ—Ä–∏–∞–ª'],
            'volume': row['–û–±—ä–µ–º'],
            'cost': row['–¶–µ–Ω–∞'],
            'estimate_position': row['–ü–æ–∑–∏—Ü–∏—è']
        })
    
    return results
```

```python
# parsers/pdf_parser.py
import pdfplumber
import re

def parse_act_pdf(file_path):
    """–ü–∞—Ä—Å–∏–Ω–≥ –∞–∫—Ç–∞ (—Ç–µ–∫—Å—Ç–æ–≤—ã–π PDF)"""
    with pdfplumber.open(file_path) as pdf:
        text = "\n".join([page.extract_text() for page in pdf.pages])
    
    # –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
    act_number = re.search(r'–ê–ò–î[- ]?(\d+)', text)
    act_date = re.search(r'(\d{2}\.\d{2}\.\d{4})', text)
    
    return {
        'act_number': act_number.group(1) if act_number else None,
        'act_date': act_date.group(1) if act_date else None,
        'raw_text': text[:500]  # –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    }
```

**Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
```yaml
file-processor:
  image: python:3.11
  container_name: file-processor
  restart: unless- stopped
  volumes:
    - ./backend/file_processor:/app
  working_dir: /app
  command: python worker.py
  environment:
    NEXTCLOUD_URL: https://cloud.structura-most.ru
    NEXTCLOUD_USER: admin
    NEXTCLOUD_PASS: ${NEXTCLOUD_PASSWORD}
    DATABASE_URL: postgresql://speckle:pass@postgres_speckle:5432/structura
  networks:
    - internal
  depends_on:
    - postgres_speckle
    - nextcloud
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (requirements.txt):**
```
webdav3==3.14.6        # Nextcloud WebDAV
psycopg2-binary==2.9.9 # PostgreSQL
pandas==2.1.4          # Excel
pdfplumber==0.10.3     # PDF text
pytesseract==0.3.10    # OCR
Pillow==10.1.0         # Image
schedule==1.2.0        # –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
```

---

### 3.7. MinIO - S3 Object Storage

**–†–æ–ª—å:** –•—Ä–∞–Ω–∏–ª–∏—â–µ –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≥–µ–æ–º–µ—Ç—Ä–∏—è BIM –º–æ–¥–µ–ª–∏)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –•—Ä–∞–Ω–∏—Ç blob –¥–∞–Ω–Ω—ã–µ (—Ñ–∞–π–ª—ã –≥–µ–æ–º–µ—Ç—Ä–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** Speckle Server
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø—Ä—è–º—É—é —Å –Ω–∏–º –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```yaml
minio:
  image: minio/minio:latest
  command: server /data --console-address ":9001"
  ports:
    - "9000:9000"    # S3 API
    - "9001:9001"    # Web Console
  environment:
    MINIO_ROOT_USER: ${MINIO_ROOT_USER}
    MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD}
    MINIO_SERVER_URL: https://s3.structura-most.ru
    MINIO_API_CORS_ALLOW_ORIGIN: "*"
  volumes:
    - ../data/minio:/data
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è:**
```
MinIO buckets:
‚îî‚îÄ speckle-server/
   ‚îú‚îÄ geometry-abc123.bin    (–≥–µ–æ–º–µ—Ç—Ä–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ 1)
   ‚îú‚îÄ geometry-def456.bin    (–≥–µ–æ–º–µ—Ç—Ä–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ 2)
   ‚îî‚îÄ ...
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üê **Speckle Server** (—á–∏—Ç–∞–µ—Ç/–ø–∏—à–µ—Ç —á–µ—Ä–µ–∑ S3 –ø—Ä–æ—Ç–æ–∫–æ–ª)
- ‚Üê **Traefik** (–ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç `s3.structura-most.ru` ‚Üí MinIO:9000)

**–í–∞–∂–Ω–æ:**
- MinIO –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –æ—Ç –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Speckle Server
- –î–∞–Ω–Ω—ã–µ –≤ MinIO –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ PostgreSQL

---

### 3.8. Redis - –ö–µ—à

**–†–æ–ª—å:** In-memory –∫–µ—à –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã Speckle –∏ Nextcloud

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ö–µ—à–∏—Ä—É–µ—Ç —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ
- –•—Ä–∞–Ω–∏—Ç —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£—Å–∫–æ—Ä—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```yaml
redis:
  image: redis:7-alpine
  command: redis-server --requirepass ${REDIS_PASSWORD}
  ports:
    - "6379:6379"
  volumes:
    - ../data/redis:/data
```

**–ß—Ç–æ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è:**
- **Speckle:** –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–æ–≤, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ GraphQL
- **Nextcloud:** –°–ø–∏—Å–∫–∏ —Ñ–∞–π–ª–æ–≤, –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üê **Speckle Server** (–∫–µ—à –∑–∞–ø—Ä–æ—Å–æ–≤)
- ‚Üê **Nextcloud** (–∫–µ—à —Ñ–∞–π–ª–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ BIM –º–æ–¥–µ–ª–∏ (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –±—ã—Å—Ç—Ä–µ–µ)
- ‚ö° –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ PostgreSQL

---

### 3.9. Traefik - Reverse Proxy & SSL

**–†–æ–ª—å:** –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SSL

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç HTTPS —Ç—Ä–∞—Ñ–∏–∫ –∫ –Ω—É–∂–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (Let's Encrypt)
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç HTTPS –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤

**–ú–∞—Ä—à—Ä—É—Ç—ã:**
```
https://app.structura-most.ru       ‚Üí Refine Frontend (–ø–æ—Ä—Ç 80)
https://speckle.structura-most.ru   ‚Üí Speckle Frontend (–ø–æ—Ä—Ç 3000)
https://cloud.structura-most.ru     ‚Üí Nextcloud (–ø–æ—Ä—Ç 80)
https://s3.structura-most.ru        ‚Üí MinIO (–ø–æ—Ä—Ç 9000)
https://grafana.structura-most.ru   ‚Üí Grafana (–ø–æ—Ä—Ç 3000)
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (docker labels):**
```yaml
refine-app:
  labels:
    - "traefik.enable=true"
    - "traefik.http.routers.refine.rule=Host(`app.structura-most.ru`)"
    - "traefik.http.routers.refine.entrypoints=websecure"
    - "traefik.http.routers.refine.tls=true"
    - "traefik.http.routers.refine.tls.certresolver=lehttp"
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üí **–í—Å–µ –≤–µ–±-—Å–µ—Ä–≤–∏—Å—ã** (–ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP/HTTPS)
- ‚Üí **Let's Encrypt** (–ø–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üîí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π HTTPS –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- üîß –ù–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Nginx/Apache
- üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Docker labels (Infrastructure as Code)

---

### 3.10. Grafana - –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞—à–±–æ—Ä–¥—ã

**–†–æ–ª—å:** –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è KPI –∏ –º–µ—Ç—Ä–∏–∫ –∏–∑ PostgreSQL

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ (–ø–ª–∞–Ω vs —Ñ–∞–∫—Ç)
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥/—ç–∫–æ–Ω–æ–º–∏—é –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)
- –°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (CPU, RAM, PostgreSQL —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL:**
```yaml
grafana:
  image: grafana/grafana:latest
  environment:
    GF_SECURITY_ADMIN_PASSWORD: ${GRAFANA_PASSWORD}
    GF_DATABASE_TYPE: postgres
    GF_DATABASE_HOST: postgres_speckle:5432
    GF_DATABASE_NAME: structura
    GF_DATABASE_USER: grafana_readonly
  ports:
    - "3002:3000"
```

**–ü—Ä–∏–º–µ—Ä—ã –¥–∞—à–±–æ—Ä–¥–æ–≤:**

1. **–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ:**
   ```sql
   -- –ü–ª–∞–Ω vs –§–∞–∫—Ç –ø–æ –∑–∞—Ö–≤–∞—Ç–∫–∞–º
   SELECT 
       z.name AS zone,
       SUM(st.planned_volume) AS plan,
       SUM(st.actual_volume) AS fact,
       (SUM(st.actual_volume) / NULLIF(SUM(st.planned_volume), 0) * 100) AS completion_pct
   FROM shift_tasks st
   JOIN zones z ON st.zone_id = z.id
   GROUP BY z.name;
   ```

2. **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:**
   ```sql
   -- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º
   SELECT 
       m.name,
       SUM(me.planned_volume) AS plan,
       SUM(ma.volume) AS actual,
       (SUM(ma.volume) - SUM(me.planned_volume)) AS deviation
   FROM materials m
   LEFT JOIN materials_estimate me ON m.id = me.material_id
   LEFT JOIN materials_actual ma ON m.id = ma.material_id
   GROUP BY m.name
   HAVING ABS(deviation) > 5;
   ```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üí **PostgreSQL** (`structura` –ë–î) - —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤
- ‚Üê **Traefik** - –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ `grafana.structura-most.ru`
- ‚Üî **Refine** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤ —á–µ—Ä–µ–∑ iframe

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üìä –í–∏–∑—É–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –±–µ–∑ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
- üì± –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
- üö® –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö

---

## 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–¥–µ—Ç–∞–ª—å–Ω–æ)

### 4.1. –ú–∞—Ç—Ä–∏—Ü–∞ –≤—Å–µ—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç A | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç B | –ü—Ä–æ—Ç–æ–∫–æ–ª | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------------|-------------|----------|-------------|------------|
| Refine | PostgREST | HTTP/REST | ‚Üí | CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| PostgREST | PostgreSQL | TCP/SQL | ‚Üí | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ |
| Refine | Speckle API | HTTP/GraphQL | ‚Üí | –ó–∞–≥—Ä—É–∑–∫–∞ BIM –º–æ–¥–µ–ª–∏ |
| Refine | Nextcloud | HTTP/WebDAV | ‚Üî | –ó–∞–≥—Ä—É–∑–∫–∞/—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ |
| Speckle Server | PostgreSQL | TCP/SQL | ‚Üî | –•—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤/–∫–æ–º–º–∏—Ç–æ–≤ |
| Speckle Server | MinIO | HTTP/S3 | ‚Üî | –•—Ä–∞–Ω–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ |
| Speckle Server | Redis | TCP/Redis | ‚Üî | –ö–µ—à |
| Nextcloud | Redis | TCP/Redis | ‚Üî | –ö–µ—à |
| File Processor | Nextcloud | HTTP/WebDAV | ‚Üí | –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ |
| File Processor | PostgreSQL | TCP/SQL | ‚Üí | –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| Grafana | PostgreSQL | TCP/SQL | ‚Üí | –ß—Ç–µ–Ω–∏–µ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤ |
| Traefik | Refine | HTTP | ‚Üí | –ü—Ä–æ–∫—Å–∏ |
| Traefik | Speckle | HTTP | ‚Üí | –ü—Ä–æ–∫—Å–∏ |
| Traefik | Nextcloud | HTTP | ‚Üí | –ü—Ä–æ–∫—Å–∏ |
| Traefik | PostgREST | HTTP | ‚Üí | –ü—Ä–æ–∫—Å–∏ |
| Traefik | Grafana | HTTP | ‚Üí | –ü—Ä–æ–∫—Å–∏ |

### 4.2. –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

#### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 1: Refine ‚Üí PostgREST ‚Üí PostgreSQL**

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å

```
[Refine UI]
    ‚Üì (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É)
[Form.onSubmit()]
    ‚Üì
[dataProvider.create()]
    ‚Üì
POST /elements
{
  "guid": "abc-123",
  "element_type": "Beam",
  "material": "Steel"
}
    ‚Üì
[PostgREST]
    ‚Üì
INSERT INTO elements (guid, element_type, material)
VALUES ('abc-123', 'Beam', 'Steel');
    ‚Üì
[PostgreSQL]
    ‚Üì (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—É—é –∑–∞–ø–∏—Å—å)
{
  "guid": "abc-123",
  "element_type": "Beam",
  "material": "Steel",
  "created_at": "2025-01-15T10:30:00Z"
}
    ‚Üì
[Refine –æ–±–Ω–æ–≤–ª—è–µ—Ç UI]
```

**–ö–æ–¥:**
```typescript
// Refine
const { formProps } = useForm();

<Form {...formProps}>
  <Form.Item name="guid">
    <Input />
  </Form.Item>
  <Form.Item name="element_type">
    <Select options={...} />
  </Form.Item>
</Form>

// dataProvider –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑–æ–≤–µ—Ç:
// POST http://localhost:3001/elements
// Content-Type: application/json
// { "guid": "...", "element_type": "..." }
```

---

#### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 2: Refine ‚Üí Speckle Viewer**

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ó–∞–≥—Ä—É–∑–∫–∞ BIM –º–æ–¥–µ–ª–∏ –≤ Viewer

```
[Refine]
    ‚Üì (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É BIM Viewer)
[BIMViewer.tsx]
    ‚Üì
const modelUrl = "https://speckle.structura-most.ru/projects/abc/models/def";
viewer.loadObject(modelUrl);
    ‚Üì
[Speckle Viewer SDK]
    ‚Üì (GET –∑–∞–ø—Ä–æ—Å –∫ Speckle API)
GET https://speckle.structura-most.ru/api/stream/abc/commit/def
    ‚Üì
[Speckle Server API]
    ‚Üì (—á–∏—Ç–∞–µ—Ç –∏–∑ PostgreSQL + MinIO)
SELECT * FROM objects WHERE commit_id = 'def';
    ‚Üì
GET http://minio:9000/speckle-server/geometry-abc123.bin
    ‚Üì (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ)
{
  "objects": [...],
  "geometry": "..."
}
    ‚Üì
[Speckle Viewer —Ä–µ–Ω–¥–µ—Ä–∏—Ç –≤ WebGL]
```

**–ö–æ–¥:**
```typescript
import { Viewer } from "@speckle/viewer";

const viewer = new Viewer({ container });

// –ó–∞–≥—Ä—É–∑–∫–∞
await viewer.loadObject(modelUrl);

// –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
viewer.on('load-complete', () => {
  const tree = viewer.getWorldTree();
  tree.walk((node) => {
    console.log(node.model.id); // GUID
  });
});
```

---

#### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 3: Refine ‚Üí Nextcloud (–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞)**

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç PDF –∞–∫—Ç–∞

```
[Refine UI]
    ‚Üì (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–∞–π–ª)
<input type="file" onChange={handleUpload} />
    ‚Üì
[handleUpload()]
    ‚Üì
const client = createClient("https://cloud.../dav");
await client.putFileContents("/files/.../–ê–∫—Ç_001.pdf", fileBuffer);
    ‚Üì
[Nextcloud WebDAV]
    ‚Üì (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª)
/var/www/nextcloud/data/admin/files/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–ê–∫—Ç—ã/–ê–∫—Ç_001.pdf
    ‚Üì (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Å–ø–µ—Ö)
201 Created
    ‚Üì
[Refine —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—É—Ç—å –≤ –ë–î]
dataProvider.create({
  resource: "aid_acts",
  variables: {
    act_number: "–ê–ò–î-001",
    pdf_file_path: "/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–ê–∫—Ç—ã/–ê–∫—Ç_001.pdf"
  }
});
```

---

#### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 4: File Processor ‚Üí Nextcloud ‚Üí PostgreSQL**

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ê–≤—Ç–æ–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ Excel

```
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤ Nextcloud]
/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–°–º–µ—Ç—ã/–°–º–µ—Ç–∞_–Ø–Ω–≤–∞—Ä—å.xlsx
    ‚Üì (—á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç)
[File Processor - scan_folders()]
    ‚Üì
client.list("/files/admin/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–°–º–µ—Ç—ã")
    ‚Üì
[Nextcloud WebDAV –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫]
[
  { "path": "/.../ –°–º–µ—Ç–∞_–Ø–Ω–≤–∞—Ä—å.xlsx", "modified": "2025-01-15T10:00:00Z" }
]
    ‚Üì
[–ü—Ä–æ–≤–µ—Ä–∫–∞: –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ª–∏ —Ñ–∞–π–ª?]
SELECT * FROM processed_files WHERE file_path = '...';
    ‚Üì (–Ω–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º)
[–°–∫–∞—á–∏–≤–∞–Ω–∏–µ]
client.download_file("/files/.../–°–º–µ—Ç–∞_–Ø–Ω–≤–∞—Ä—å.xlsx", "/tmp/smeta.xlsx")
    ‚Üì
[–ü–∞—Ä—Å–∏–Ω–≥]
df = pd.read_excel("/tmp/smeta.xlsx", sheet_name='–ú–∞—Ç–µ—Ä–∏–∞–ª—ã')
    ‚Üì
[–ó–∞–ø–∏—Å—å –≤ PostgreSQL]
FOR –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏:
  INSERT INTO materials_estimate 
  (material_name, volume, cost, source_file)
  VALUES (..., ..., ..., '/files/.../–°–º–µ—Ç–∞_–Ø–Ω–≤–∞—Ä—å.xlsx');
    ‚Üì
[–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ]
INSERT INTO processed_files 
(file_path, status, created_records)
VALUES ('/files/.../–°–º–µ—Ç–∞_–Ø–Ω–≤–∞—Ä—å.xlsx', 'processed', 15);
    ‚Üì
[Refine –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ]
"–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 15 –ø–æ–∑–∏—Ü–∏–π –∏–∑ —Ñ–∞–π–ª–∞ –°–º–µ—Ç–∞_–Ø–Ω–≤–∞—Ä—å.xlsx"
```

---

## 5. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 5.1. Docker Compose –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
docker/
‚îú‚îÄ docker-compose.base.yml       (PostgreSQL, Redis, MinIO)
‚îú‚îÄ docker-compose.speckle.yml    (Speckle —Å–µ—Ä–≤–∏—Å—ã)
‚îú‚îÄ docker-compose.nextcloud.yml  (Nextcloud)
‚îú‚îÄ docker-compose.structura.yml  (PostgREST, File Processor)
‚îú‚îÄ docker-compose.frontend.yml   (Refine UI)
‚îî‚îÄ docker-compose.prod.yml       (Traefik, Grafana)
```

**–ó–∞–ø—É—Å–∫:**
```bash
# Development
docker-compose -f docker-compose.base.yml \
               -f docker-compose.speckle.yml \
               -f docker-compose.nextcloud.yml \
               -f docker-compose.structura.yml \
               up -d

# Production (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è Traefik)
docker-compose -f docker-compose.*.yml up -d
```

### 5.2. Docker Networks

```
networks:
  web:        # –í–Ω–µ—à–Ω—è—è —Å–µ—Ç—å (Traefik ‚Üí –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)
    external: true
  
  internal:   # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å (—Å–µ—Ä–≤–∏—Å—ã –º–µ–∂–¥—É —Å–æ–±–æ–π)
    driver: bridge
```

**–ö—Ç–æ –≤ –∫–∞–∫–æ–π —Å–µ—Ç–∏:**
- `web`: Traefik, Refine, Speckle Frontend, Nextcloud, Grafana
- `internal`: PostgreSQL, Redis, MinIO, PostgREST, File Processor, Speckle backend

### 5.3. Volumes (Persistence)

```
volumes:
  ../data/postgres_speckle    ‚Üí PostgreSQL –¥–∞–Ω–Ω—ã–µ
  ../data/redis               ‚Üí Redis RDB
  ../data/minio               ‚Üí MinIO buckets
  ../data/nextcloud           ‚Üí Nextcloud —Ñ–∞–π–ª—ã
```

---

## 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 6.1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞

**–£—Ä–æ–≤–µ–Ω—å 1: Traefik (HTTPS + BasicAuth)**
```yaml
labels:
  - "traefik.http.middlewares.auth.basicauth.users=user:$$apr1$$..."
  - "traefik.http.routers.app.middlewares=auth@docker"
```

**–£—Ä–æ–≤–µ–Ω—å 2: PostgREST (—Ä–æ–ª–∏ PostgreSQL)**
```sql
-- –ê–Ω–æ–Ω–∏–º (—Ç–æ–ª—å–∫–æ SELECT)
CREATE ROLE web_anon;
GRANT SELECT ON specific_tables TO web_anon;

-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (CRUD)
CREATE ROLE web_user;
GRANT SELECT, INSERT, UPDATE, DELETE ON user_tables TO web_user;
```

**–£—Ä–æ–≤–µ–Ω—å 3: Row Level Security (RLS)**
```sql
ALTER TABLE shift_tasks ENABLE ROW LEVEL SECURITY;

CREATE POLICY user_sees_own_tasks
ON shift_tasks
FOR SELECT
USING (user_id = current_setting('request.jwt.claim.sub')::INTEGER);
```

### 6.2. –°–µ–∫—Ä–µ—Ç—ã

**–•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π:**
```
.env (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ Git)
POSTGRES_PASSWORD=...
REDIS_PASSWORD=...
MINIO_ROOT_PASSWORD=...
NEXTCLOUD_ADMIN_PASSWORD=...
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ docker-compose:**
```yaml
environment:
  POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
```

---

## 7. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### 7.1. –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker logs -f postgrest
docker logs -f file-processor
docker logs -f speckle-server

# –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
docker logs postgrest > postgrest.log 2>&1
```

### 7.2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
# –†–µ–∞–ª-—Ç–∞–π–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
docker ps
```

### 7.3. Grafana –¥–∞—à–±–æ—Ä–¥—ã

- **–°–∏—Å—Ç–µ–º–∞:** CPU, RAM, Disk (—á–µ—Ä–µ–∑ node-exporter)
- **PostgreSQL:** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **File Processor:** –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã, –æ—à–∏–±–∫–∏

---

## 8. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### 8.1. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ß—Ç–æ –º–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å:**
- ‚úÖ Refine Frontend (Nginx —Å—Ç–∞—Ç–∏–∫–∞ ‚Üí CDN)
- ‚úÖ PostgREST (–¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–ø–ª–∏–∫–∏)
- ‚úÖ File Processor (–∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ workers)

**–ß—Ç–æ —Å–ª–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å:**
- ‚ùå PostgreSQL (–Ω—É–∂–Ω–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è master-slave)
- ‚ùå Speckle Server (—Å–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

### 8.2. –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏:**
1. –£–≤–µ–ª–∏—á–∏—Ç—å PostgreSQL RAM (shared_buffers)
2. –î–æ–±–∞–≤–∏—Ç—å CPU –¥–ª—è File Processor (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
3. SSD –¥–ª—è PostgreSQL –∏ MinIO

---

## 9. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# PostgreSQL
docker exec postgres_speckle pg_dump -U speckle structura > backup.sql

# Nextcloud —Ñ–∞–π–ª—ã
rsync -av data/nextcloud/ /backup/nextcloud/

# MinIO (S3)
mc mirror minio/speckle-server /backup/minio/
```

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** 31.12.2024  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
