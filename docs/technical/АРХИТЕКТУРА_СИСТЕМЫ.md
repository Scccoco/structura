# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Digital Twin —Å–∏—Å—Ç–µ–º—ã –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞

> **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 31.12.2024  
> **–í–µ—Ä—Å–∏—è:** 1.0  
> **–°—Ç–∞—Ç—É—Å:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã](#–æ–±—â–µ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-—Å–∏—Å—Ç–µ–º—ã)
2. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
4. [–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ö–µ–º–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
6. [–°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#—Å—Ü–µ–Ω–∞—Ä–∏–∏-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
7. [–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-—Ñ–∞–π–ª–æ–≤)
8. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)

---

## 1. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### 1.1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Digital Twin —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ BIM-–º–æ–¥–µ–ª–∏ –∫–∞–∫ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ —Å–∫–µ–ª–µ—Ç–∞. –°–∏—Å—Ç–µ–º–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç:

- –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (BIM)
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç
- –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ
- –£—á–µ—Ç —Ñ–∞–∫—Ç–∞
- –§–∏–Ω–∞–Ω—Å—ã
- –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### 1.2. –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **BIM –º–æ–¥–µ–ª—å –∫–∞–∫ –æ—Å–Ω–æ–≤–∞** - –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ GUID
2. **–ï–¥–∏–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —Å–≤—è–∑–∞–Ω—ã
3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞** - –ø–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ –∏–∑ Nextcloud
4. **–†—É—Å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤ –∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π
5. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª–µ–π

### 1.3. –¶–µ–ª–µ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

- –ò–¢–† (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π, –∫–æ–Ω—Ç—Ä–æ–ª—å)
- –ò–Ω–∂–µ–Ω–µ—Ä—ã (—Ä–∞–±–æ—Ç–∞ —Å –∞–∫—Ç–∞–º–∏, –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏)
- –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –¥–∞—à–±–æ—Ä–¥—ã)
- –ü—Ä–æ—Ä–∞–±—ã (–ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞–Ω–∏–π)

---

## 2. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### 2.1. –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–µ–∫ (—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–π)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   –°–õ–û–ò –°–ò–°–¢–ï–ú–´                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Frontend:     Refine.dev + React + Ant Design (—Ä—É—Å—Å–∫–∏–π)
API:          PostgREST (–∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ PostgreSQL)
Database:     PostgreSQL 15 (–µ–¥–∏–Ω–∞—è –ë–î)
BIM:          Speckle Server (–º–æ–¥–µ–ª–∏ + GUID)
Files:        Nextcloud (PDF, Excel, —Ñ–æ—Ç–æ)
Processing:   Python Workers (–ø–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤)
Storage:      MinIO (S3 –¥–ª—è Speckle)
Cache:        Redis
Routing:      Traefik (reverse proxy + SSL)
Analytics:    Grafana (–¥–∞—à–±–æ—Ä–¥—ã)
```

### 2.2. –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|-----------|--------|-----------|
| **Frontend** | Refine.dev | latest | UI —Ñ–æ—Ä–º—ã, —Ç–∞–±–ª–∏—Ü—ã, BIM Viewer |
| | React | 18+ | Framework |
| | Ant Design | 5+ | UI –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (—Ä—É—Å—Å–∫–∏–π) |
| | Speckle Viewer SDK | 2.17+ | 3D –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è |
| **Backend API** | PostgREST | 11+ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π REST API |
| **Database** | PostgreSQL | 15-alpine | –í—Å–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| **BIM Server** | Speckle Server | latest | –•—Ä–∞–Ω–∏–ª–∏—â–µ BIM –º–æ–¥–µ–ª–µ–π |
| **File Storage** | Nextcloud | latest | PDF, Excel, —Ñ–æ—Ç–æ |
| **File Processor** | Python | 3.11+ | –ü–∞—Ä—Å–∏–Ω–≥ Excel, PDF OCR |
| | pandas | 2.0+ | –û–±—Ä–∞–±–æ—Ç–∫–∞ Excel |
| | pdfplumber | 0.10+ | –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF |
| | tesseract-ocr | 5.0+ | OCR –¥–ª—è —Å–∫–∞–Ω–æ–≤ |
| **Object Storage** | MinIO | latest | S3 –¥–ª—è Speckle |
| **Cache** | Redis | 7-alpine | –ö–µ—à –¥–ª—è Speckle/Nextcloud |
| **Proxy** | Traefik | v2.10+ | SSL + –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è |
| **Analytics** | Grafana | latest | –î–∞—à–±–æ—Ä–¥—ã |

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 3.1. –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨                             ‚îÇ
‚îÇ              (–ë—Ä–∞—É–∑–µ—Ä: Chrome, Edge, Safari)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ HTTPS
                             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        TRAEFIK                               ‚îÇ
‚îÇ           (Reverse Proxy + SSL Termination)                  ‚îÇ
‚îî‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚îÇ                ‚îÇ                ‚îÇ              ‚îÇ
  ‚Üì                ‚Üì                ‚Üì              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Refine    ‚îÇ ‚îÇ   Speckle    ‚îÇ ‚îÇ Nextcloud  ‚îÇ ‚îÇ   Grafana   ‚îÇ
‚îÇ  Frontend   ‚îÇ ‚îÇ   Frontend   ‚îÇ ‚îÇ            ‚îÇ ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ               ‚îÇ               ‚îÇ               ‚îÇ
       ‚îÇ REST API      ‚îÇ REST API      ‚îÇ WebDAV        ‚îÇ SQL
       ‚Üì               ‚Üì               ‚Üì               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgREST   ‚îÇ ‚îÇ   Speckle    ‚îÇ ‚îÇ Nextcloud  ‚îÇ ‚îÇ  PostgreSQL  ‚îÇ
‚îÇ  (Auto API)  ‚îÇ ‚îÇ   Server     ‚îÇ ‚îÇ   Server   ‚îÇ ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                ‚îÇ               ‚îÇ               ‚îÇ
       ‚îÇ SQL            ‚îÇ SQL           ‚îÇ               ‚îÇ
       ‚Üì                ‚Üì               ‚îÇ               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PostgreSQL 15                             ‚îÇ
‚îÇ  ‚îú‚îÄ speckle (–ë–î –¥–ª—è Speckle Server)                          ‚îÇ
‚îÇ  ‚îî‚îÄ structura (–ë–î –¥–ª—è Digital Twin —Å–∏—Å—Ç–µ–º—ã)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚Üì                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MinIO (S3)        ‚îÇ         ‚îÇ   Redis (Cache)      ‚îÇ
‚îÇ  (Blob storage –¥–ª—è  ‚îÇ         ‚îÇ  (Speckle + NC)      ‚îÇ
‚îÇ   Speckle –≥–µ–æ–º–µ—Ç—Ä–∏–∏)‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               FILE PROCESSOR (Python Worker)                 ‚îÇ
‚îÇ  –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç Nextcloud ‚Üí –ø–∞—Ä—Å–∏—Ç —Ñ–∞–π–ª—ã ‚Üí –ë–î       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3.2. –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### **PostgreSQL** - –ï–¥–∏–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–†–æ–ª—å:** –°–µ—Ä–¥—Ü–µ —Å–∏—Å—Ç–µ–º—ã, —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
- `speckle` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Speckle Server (–Ω–µ —Ç—Ä–æ–≥–∞–µ–º)
- `structura` - –Ω–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ (–≤—Å–µ –º–æ–¥—É–ª–∏)

**–¢–∞–±–ª–∏—Ü—ã (–æ—Å–Ω–æ–≤–Ω—ã–µ):**
```
structura
‚îú‚îÄ elements              (GUID + –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ BIM)
‚îú‚îÄ zones                 (–∑–∞—Ö–≤–∞—Ç–∫–∏)
‚îú‚îÄ shift_tasks           (—Å–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è)
‚îú‚îÄ shift_task_elements   (—Å–≤—è–∑—å –∑–∞–¥–∞–Ω–∏–π —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏)
‚îú‚îÄ aid_acts              (–∞–∫—Ç—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
‚îú‚îÄ aid_act_elements      (—Å–≤—è–∑—å –∞–∫—Ç–æ–≤ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏)
‚îú‚îÄ materials             (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤)
‚îú‚îÄ materials_estimate    (–º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ —Å–º–µ—Ç–µ)
‚îú‚îÄ materials_rd          (–º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –†–î)
‚îú‚îÄ materials_actual      (–º–∞—Ç–µ—Ä–∏–∞–ª—ã —Ñ–∞–∫—Ç –∏–∑ 1–°)
‚îú‚îÄ brigades              (–±—Ä–∏–≥–∞–¥—ã)
‚îú‚îÄ work_types            (–≤–∏–¥—ã —Ä–∞–±–æ—Ç)
‚îî‚îÄ processed_files       (–∂—É—Ä–Ω–∞–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤)
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üê Speckle Server (—á–∏—Ç–∞–µ—Ç/–ø–∏—à–µ—Ç –≤ `speckle`)
- ‚Üê PostgREST (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç API –∏–∑ `structura`)
- ‚Üê Grafana (—á–∏—Ç–∞–µ—Ç –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤)
- ‚Üê File Processor (–ø–∏—à–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞)

---

#### **Speckle Server** - BIM —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

**–†–æ–ª—å:** –•—Ä–∞–Ω–∏–ª–∏—â–µ BIM –º–æ–¥–µ–ª–µ–π, –∏—Å—Ç–æ—á–Ω–∏–∫ GUID

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `speckle-server` - –≥–ª–∞–≤–Ω—ã–π API
- `speckle-frontend` - Web UI
- `speckle-preview` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—å—é
- `speckle-webhook` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö
- `speckle-fileimport` - –∑–∞–≥—Ä—É–∑–∫–∞ IFC —Ñ–∞–π–ª–æ–≤

**–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç:**
- BIM –º–æ–¥–µ–ª–∏ (IFC, Tekla)
- –í–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–µ–π (–∫–æ–º–º–∏—Ç—ã)
- GUID —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –ì–µ–æ–º–µ—Ç—Ä–∏—é (–≤ MinIO)
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üí MinIO (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –ø–æ S3 –ø—Ä–æ—Ç–æ–∫–æ–ª—É)
- ‚Üí PostgreSQL (`speckle` –ë–î)
- ‚Üí Redis (–∫–µ—à)
- ‚Üê Refine Frontend (–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ Viewer SDK)
- ‚Üê File Processor (—á–∏—Ç–∞–µ—Ç GUID –¥–ª—è —Å–≤—è–∑–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏)

---

#### **PostgREST** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π REST API

**–†–æ–ª—å:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç REST API –∏–∑ —Å—Ö–µ–º—ã PostgreSQL

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
```sql
-- –í—ã —Å–æ–∑–¥–∞–µ—Ç–µ —Ç–∞–±–ª–∏—Ü—É –≤ PostgreSQL
CREATE TABLE shift_tasks (
    id SERIAL PRIMARY KEY,
    date DATE,
    brigade_id INTEGER
);

-- PostgREST –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç endpoints:
GET    /shift_tasks              -- —Å–ø–∏—Å–æ–∫
POST   /shift_tasks              -- —Å–æ–∑–¥–∞—Ç—å
PATCH  /shift_tasks?id=eq.1      -- –æ–±–Ω–æ–≤–∏—Ç—å
DELETE /shift_tasks?id=eq.1      -- —É–¥–∞–ª–∏—Ç—å
GET    /shift_tasks?select=*,brigades(*)  -- JOIN
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üí PostgreSQL (`structura` –ë–î)
- ‚Üê Refine Frontend (–≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –¥–∞–Ω–Ω—ã–º)

---

#### **Refine.dev** - Frontend UI

**–†–æ–ª—å:** –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–∏—Å—Ç–µ–º—ã (—Ñ–æ—Ä–º—ã, —Ç–∞–±–ª–∏—Ü—ã, BIM Viewer)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- React 18
- Ant Design 5 (—Ä—É—Å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- Speckle Viewer SDK 2.17

**–°—Ç—Ä–∞–Ω–∏—Ü—ã:**
```
/login                    ‚Üí –í—Ö–æ–¥
/dashboard                ‚Üí –ì–ª–∞–≤–Ω–∞—è (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
/shift-tasks              ‚Üí –†–µ–µ—Å—Ç—Ä —Å–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
/shift-tasks/create       ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
/shift-tasks/:id          ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
/aid-acts                 ‚Üí –†–µ–µ—Å—Ç—Ä –∞–∫—Ç–æ–≤ –ê–ò–î
/aid-acts/create          ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ç–∞
/materials                ‚Üí –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (–ø–ª–∞–Ω-—Ñ–∞–∫—Ç)
/files                    ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
/bim-viewer               ‚Üí –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π BIM Viewer
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üí PostgREST (CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏)
- ‚Üí Speckle API (–∑–∞–≥—Ä—É–∑–∫–∞ BIM –º–æ–¥–µ–ª–∏)
- ‚Üí Nextcloud WebDAV (–∑–∞–≥—Ä—É–∑–∫–∞/—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤)

---

#### **Nextcloud** - –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤

**–†–æ–ª—å:** –§–∞–π–ª–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è PDF, Excel, —Ñ–æ—Ç–æ

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫:**
```
/–ü—Ä–æ–µ–∫—Ç—ã/
  /–ú–ì–£/
    /–ê–∫—Ç—ã/               (PDF –∞–∫—Ç–æ–≤ –ê–ò–î)
    /–ö–°-2/               (PDF –ö–°-2)
    /–°–º–µ—Ç—ã/              (Excel —Å–º–µ—Ç—ã)
    /–†–î/                 (–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏)
    /–§–æ—Ç–æ/               (–§–æ—Ç–æ—Ñ–∏–∫—Å–∞—Ü–∏—è)
    /–°–º–µ–Ω–Ω—ã–µ_–∑–∞–¥–∞–Ω–∏—è/    (PDF –∑–∞–¥–∞–Ω–∏–π)
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üê Refine (–∑–∞–≥—Ä—É–∑–∫–∞/—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ WebDAV)
- ‚Üê File Processor (—á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞)

---

#### **File Processor** - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤

**–†–æ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ –∏–∑ Nextcloud

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
```
1. –°–∫–∞–Ω–∏—Ä—É–µ—Ç –ø–∞–ø–∫–∏ Nextcloud –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
2. –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
3. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Ñ–∞–π–ª–∞ (Excel, PDF, CSV)
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ä—Å–µ—Ä
5. –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
6. –°–æ–∑–¥–∞–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –∑–∞–ø–∏—Å–µ–π –≤ PostgreSQL
7. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- Excel (.xlsx) - —Å–º–µ—Ç—ã, –≤–µ–¥–æ–º–æ—Å—Ç–∏, —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- PDF (—Ç–µ–∫—Å—Ç–æ–≤—ã–π) - –∞–∫—Ç—ã, –ö–°-2
- PDF (—Å–∫–∞–Ω) - OCR —á–µ—Ä–µ–∑ tesseract
- CSV - –≤—ã–≥—Ä—É–∑–∫–∏ –∏–∑ 1–°

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Python 3.11
- pandas (Excel)
- pdfplumber (PDF)
- tesseract-ocr (OCR)
- webdav3 (Nextcloud API)
- psycopg2 (PostgreSQL)

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üí Nextcloud WebDAV (—á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤)
- ‚Üí PostgreSQL (–∑–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)

---

#### **MinIO** - S3 Object Storage

**–†–æ–ª—å:** –•—Ä–∞–Ω–∏–ª–∏—â–µ –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Speckle

**–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç:**
- –ì–µ–æ–º–µ—Ç—Ä–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ BIM –º–æ–¥–µ–ª–∏
- Blob –¥–∞–Ω–Ω—ã–µ

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üê Speckle Server (S3 –ø—Ä–æ—Ç–æ–∫–æ–ª)

---

#### **Redis** - –ö–µ—à

**–†–æ–ª—å:** –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Speckle –∏ Nextcloud

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üê Speckle Server (–∫–µ—à –∑–∞–ø—Ä–æ—Å–æ–≤)
- ‚Üê Nextcloud (–∫–µ—à —Ñ–∞–π–ª–æ–≤)

---

#### **Traefik** - Reverse Proxy

**–†–æ–ª—å:** –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è HTTP —Ç—Ä–∞—Ñ–∏–∫–∞, SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

**–ú–∞—Ä—à—Ä—É—Ç—ã:**
```
https://app.structura-most.ru       ‚Üí Refine Frontend
https://speckle.structura-most.ru   ‚Üí Speckle Frontend
https://cloud.structura-most.ru     ‚Üí Nextcloud
https://s3.structura-most.ru        ‚Üí MinIO
https://grafana.structura-most.ru   ‚Üí Grafana
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üí –í—Å–µ –≤–µ–±-—Å–µ—Ä–≤–∏—Å—ã
- ‚Üí Let's Encrypt (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ SSL)

---

#### **Grafana** - –î–∞—à–±–æ—Ä–¥—ã

**–†–æ–ª—å:** –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**–î–∞—à–±–æ—Ä–¥—ã:**
- –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ (–ø–ª–∞–Ω-—Ñ–∞–∫—Ç –ø–æ –∑–∞—Ö–≤–∞—Ç–∫–∞–º)
- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (–ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥/—ç–∫–æ–Ω–æ–º–∏—è)
- –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)
- –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–ø–æ –±—Ä–∏–≥–∞–¥–∞–º)

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚Üí PostgreSQL (`structura` –ë–î)

---

## 4. –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 4.1. Core Tables (—Ü–∏—Ñ—Ä–æ–≤–æ–π —Å–∫–µ–ª–µ—Ç)

```sql
-- –≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–µ–ª–∏ (–∏–∑ Speckle)
CREATE TABLE elements (
    guid VARCHAR(100) PRIMARY KEY,
    speckle_object_id VARCHAR(100),
    speckle_commit_id VARCHAR(100),
    element_type VARCHAR(50),        -- Beam, Column, Slab
    material VARCHAR(100),
    profile VARCHAR(100),
    zone VARCHAR(50),
    level INTEGER,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP
);

-- –ó–∞—Ö–≤–∞—Ç–∫–∏ (—É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
CREATE TABLE zones (
    id SERIAL PRIMARY KEY,
    code VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(200) NOT NULL,
    level INTEGER,
    building VARCHAR(50),
    description TEXT
);

-- –°–≤—è–∑—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –∑–∞—Ö–≤–∞—Ç–∫–∞–º–∏
CREATE TABLE element_zones (
    element_guid VARCHAR(100) REFERENCES elements(guid),
    zone_id INTEGER REFERENCES zones(id),
    PRIMARY KEY (element_guid, zone_id)
);
```

### 4.2. –ú–æ–¥—É–ª—å "–°–º–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ"

```sql
-- –í–∏–¥—ã —Ä–∞–±–æ—Ç
CREATE TABLE work_types (
    id SERIAL PRIMARY KEY,
    code VARCHAR(20) UNIQUE,
    name VARCHAR(200) NOT NULL,
    unit VARCHAR(20),                -- —Ç, –º3, –º2, —à—Ç
    labor_rate DECIMAL(10,2)         -- –Ω–æ—Ä–º–æ-—á–∞—Å—ã –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É
);

-- –ë—Ä–∏–≥–∞–¥—ã
CREATE TABLE brigades (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    foreman VARCHAR(100),
    phone VARCHAR(20),
    specialization VARCHAR(100)
);

-- –°–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
CREATE TABLE shift_tasks (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    shift_number INTEGER,
    brigade_id INTEGER REFERENCES brigades(id),
    zone_id INTEGER REFERENCES zones(id),
    work_type_id INTEGER REFERENCES work_types(id),
    planned_volume DECIMAL(10,2),
    actual_volume DECIMAL(10,2),
    status VARCHAR(20) DEFAULT 'planned',  -- planned, in_progress, completed
    pdf_file_path VARCHAR(500),            -- –ø—É—Ç—å –≤ Nextcloud
    created_at TIMESTAMP DEFAULT NOW()
);

-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏—è (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã)
CREATE TABLE shift_task_elements (
    id SERIAL PRIMARY KEY,
    shift_task_id INTEGER REFERENCES shift_tasks(id) ON DELETE CASCADE,
    element_guid VARCHAR(100) REFERENCES elements(guid),
    planned BOOLEAN DEFAULT TRUE,
    completed BOOLEAN DEFAULT FALSE,
    completion_time TIMESTAMP
);
```

### 4.3. –ú–æ–¥—É–ª—å "–†–µ–µ—Å—Ç—Ä –ê–ò–î"

```sql
-- –ê–∫—Ç—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
CREATE TABLE aid_acts (
    id SERIAL PRIMARY KEY,
    act_number VARCHAR(50) UNIQUE NOT NULL,
    act_date DATE,
    work_type VARCHAR(200),
    contractor VARCHAR(200),
    status VARCHAR(20) DEFAULT 'draft',  -- draft, approved, rejected
    pdf_file_path VARCHAR(500),          -- –ø—É—Ç—å –≤ Nextcloud
    approver VARCHAR(100),
    approval_date DATE,
    needs_review BOOLEAN DEFAULT FALSE,  -- –¥–ª—è –∞–≤—Ç–æ–æ–±—Ä–∞–±–æ—Ç–∫–∏
    created_at TIMESTAMP DEFAULT NOW()
);

-- –°–≤—è–∑—å –∞–∫—Ç–æ–≤ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –º–æ–¥–µ–ª–∏
CREATE TABLE aid_act_elements (
    id SERIAL PRIMARY KEY,
    act_id INTEGER REFERENCES aid_acts(id) ON DELETE CASCADE,
    element_guid VARCHAR(100) REFERENCES elements(guid),
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 4.4. –ú–æ–¥—É–ª–∏ "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã"

```sql
-- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
CREATE TABLE materials (
    id SERIAL PRIMARY KEY,
    code VARCHAR(50) UNIQUE,
    name VARCHAR(200) NOT NULL,
    unit VARCHAR(20),                    -- —Ç, –º3, –∫–≥
    density DECIMAL(10,3)                -- –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –º3 ‚Üí —Ç
);

-- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –†–î (—Ä–∞—Å—á–µ—Ç)
CREATE TABLE materials_rd (
    id SERIAL PRIMARY KEY,
    element_guid VARCHAR(100) REFERENCES elements(guid),
    material_id INTEGER REFERENCES materials(id),
    volume DECIMAL(10,3),
    source VARCHAR(100),                 -- Tekla Report, Manual
    created_at TIMESTAMP DEFAULT NOW()
);

-- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ —Å–º–µ—Ç–µ (–ø–ª–∞–Ω)
CREATE TABLE materials_estimate (
    id SERIAL PRIMARY KEY,
    estimate_position VARCHAR(50),
    material_id INTEGER REFERENCES materials(id),
    zone_id INTEGER REFERENCES zones(id),
    planned_volume DECIMAL(10,3),
    cost_per_unit DECIMAL(10,2),
    total_cost DECIMAL(12,2),
    source_file VARCHAR(500)             -- –ø—É—Ç—å –∫ Excel –≤ Nextcloud
);

-- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Ñ–∞–∫—Ç (–∏–∑ 1–°)
CREATE TABLE materials_actual (
    id SERIAL PRIMARY KEY,
    material_id INTEGER REFERENCES materials(id),
    zone_id INTEGER REFERENCES zones(id),
    write_off_date DATE,
    volume DECIMAL(10,3),
    s1c_document_number VARCHAR(50),
    created_at TIMESTAMP DEFAULT NOW()
);

-- –ü—Ä–∏–≤—è–∑–∫–∞ —Å–º–µ—Ç–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º
CREATE TABLE estimate_element_mapping (
    id SERIAL PRIMARY KEY,
    estimate_position VARCHAR(50),
    element_guid VARCHAR(100) REFERENCES elements(guid),
    coefficient DECIMAL(5,3) DEFAULT 1.0  -- –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é —á–∞—Å—Ç–∏—á–Ω–æ
);
```

### 4.5. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤

```sql
-- –ñ—É—Ä–Ω–∞–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
CREATE TABLE processed_files (
    id SERIAL PRIMARY KEY,
    file_path VARCHAR(500) UNIQUE NOT NULL,
    file_type VARCHAR(50),               -- pdf, xlsx, csv
    file_size BIGINT,
    uploaded_at TIMESTAMP,
    processed_at TIMESTAMP,
    status VARCHAR(20) DEFAULT 'pending', -- pending, processed, error
    extracted_data JSONB,                -- –ß—Ç–æ –∏–∑–≤–ª–µ–∫–ª–∏ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
    created_records INTEGER DEFAULT 0,   -- –°–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π —Å–æ–∑–¥–∞–ª–∏
    needs_review BOOLEAN DEFAULT FALSE,
    error_message TEXT
);
```

---

## 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 5.1. –ú–∞—Ç—Ä–∏—Ü–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

| –û—Ç | –ö | –ü—Ä–æ—Ç–æ–∫–æ–ª | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞/–ú–µ—Ç–æ–¥ | –°—Ç–∞—Ç—É—Å |
|----|---|----------|------------------|--------|
| Refine | PostgREST | REST API | @refinedev/simple-rest | ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è |
| PostgREST | PostgreSQL | SQL | –ù–∞—Ç–∏–≤–Ω–∞—è | ‚úÖ |
| Refine | Speckle | REST API + WebSocket | @speckle/viewer | ‚úÖ SDK |
| Refine | Nextcloud | WebDAV | webdav (npm) | ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç |
| Speckle Server | PostgreSQL | SQL | –ù–∞—Ç–∏–≤–Ω–∞—è | ‚úÖ |
| Speckle Server | MinIO | S3 API | Boto3 | ‚úÖ |
| Speckle Server | Redis | Redis Protocol | ioredis | ‚úÖ |
| Nextcloud | Redis | Redis Protocol | –ù–∞—Ç–∏–≤–Ω–∞—è | ‚úÖ |
| File Processor | Nextcloud | WebDAV | webdav3 (Python) | ‚úÖ |
| File Processor | PostgreSQL | SQL | psycopg2 | ‚úÖ |
| Grafana | PostgreSQL | SQL | –ù–∞—Ç–∏–≤–Ω–∞—è | ‚úÖ |

### 5.2. –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

#### **Refine ‚Üî PostgREST**

```typescript
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Data Provider
import { dataProvider } from "@refinedev/simple-rest";

const API_URL = "https://api.structura-most.ru";

const App = () => (
  <Refine
    dataProvider={dataProvider(API_URL)}
    resources={[
      { name: "shift_tasks", ... },
      { name: "aid_acts", ... }
    ]}
  />
);
```

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**
```javascript
// CREATE
POST /shift_tasks
{
  "date": "2025-01-05",
  "brigade_id": 2,
  "zone_id": 3
}

// READ (—Å JOIN)
GET /shift_tasks?select=*,brigades(*),zones(*)

// UPDATE
PATCH /shift_tasks?id=eq.15
{ "status": "completed" }

// DELETE
DELETE /shift_tasks?id=eq.15
```

---

#### **Refine ‚Üî Speckle**

```typescript
import { Viewer } from "@speckle/viewer";

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Viewer
const viewer = new Viewer({
  container: document.getElementById("canvas"),
  showStats: true
});

// –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
const modelUrl = "https://speckle.structura-most.ru/projects/abc/models/def";
await viewer.loadObject(modelUrl);

// –†–∞—Å–∫—Ä–∞—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å—É –∞–∫—Ç–æ–≤
const elements = await fetch("/rpc/get_elements_with_acts").then(r => r.json());

elements.forEach(el => {
  const color = el.act_status === 'approved' ? '#00ff00' : '#ff0000';
  viewer.setUserObjectColors([{
    objectIds: [el.guid],
    color: color
  }]);
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤
viewer.on('object-clicked', (obj) => {
  const guid = obj.id;
  // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —ç–ª–µ–º–µ–Ω—Ç–µ
  showElementInfo(guid);
});
```

---

#### **Refine ‚Üî Nextcloud**

```typescript
import { createClient } from "webdav";

const client = createClient("https://cloud.structura-most.ru/remote.php/dav", {
  username: "admin",
  password: "password"
});

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ (–∞–∫—Ç PDF)
const uploadAct = async (file: File, actNumber: string) => {
  const path = `/files/admin/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–ê–∫—Ç—ã/–ê–∫—Ç_${actNumber}.pdf`;
  await client.putFileContents(path, file);
  
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—É—Ç—å –≤ –ë–î
  await dataProvider.create({
    resource: "aid_acts",
    variables: {
      act_number: actNumber,
      pdf_file_path: path
    }
  });
};

// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
const downloadAct = async (path: string) => {
  const url = `https://cloud.structura-most.ru/remote.php/dav${path}`;
  window.open(url, '_blank');
};
```

---

#### **File Processor ‚Üî Nextcloud ‚Üî PostgreSQL**

```python
from webdav3.client import Client
import pandas as pd
import psycopg2
import pdfplumber
import re

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Nextcloud
nextcloud = Client({
    'webdav_hostname': "https://cloud.structura-most.ru/remote.php/dav",
    'webdav_login': "admin",
    'webdav_password': "password"
})

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
conn = psycopg2.connect(
    host="postgres_speckle",
    database="structura",
    user="speckle",
    password="speckle_pass"
)

def scan_and_process():
    """–°–∫–∞–Ω–∏—Ä—É–µ—Ç –ø–∞–ø–∫–∏ Nextcloud –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã"""
    
    folders = [
        "/files/admin/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–ê–∫—Ç—ã",
        "/files/admin/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–°–º–µ—Ç—ã"
    ]
    
    for folder in folders:
        files = nextcloud.list(folder)
        
        for file_info in files:
            file_path = file_info['path']
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ –ª–∏ —É–∂–µ
            cursor = conn.cursor()
            cursor.execute(
                "SELECT id FROM processed_files WHERE file_path = %s",
                (file_path,)
            )
            if cursor.fetchone():
                continue  # –£–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
            
            # –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
            local_path = f"/tmp/{file_info['name']}"
            nextcloud.download_file(file_path, local_path)
            
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
            if file_path.endswith('.xlsx'):
                process_excel(local_path, file_path)
            elif file_path.endswith('.pdf'):
                process_pdf(local_path, file_path)

def process_excel(local_path, file_path):
    """–ü–∞—Ä—Å–∏–Ω–≥ Excel (—Å–º–µ—Ç–∞)"""
    df = pd.read_excel(local_path, sheet_name='–ú–∞—Ç–µ—Ä–∏–∞–ª—ã')
    
    cursor = conn.cursor()
    records_created = 0
    
    for _, row in df.iterrows():
        cursor.execute("""
            INSERT INTO materials_estimate 
            (estimate_position, material_id, planned_volume, cost_per_unit, source_file)
            VALUES (%s, (SELECT id FROM materials WHERE name = %s), %s, %s, %s)
        """, (
            row['–ü–æ–∑–∏—Ü–∏—è'],
            row['–ú–∞—Ç–µ—Ä–∏–∞–ª'],
            row['–û–±—ä–µ–º'],
            row['–¶–µ–Ω–∞'],
            file_path
        ))
        records_created += 1
    
    # –õ–æ–≥–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
    cursor.execute("""
        INSERT INTO processed_files 
        (file_path, file_type, status, created_records, processed_at)
        VALUES (%s, 'xlsx', 'processed', %s, NOW())
    """, (file_path, records_created))
    
    conn.commit()

def process_pdf(local_path, file_path):
    """–ü–∞—Ä—Å–∏–Ω–≥ PDF (–∞–∫—Ç)"""
    with pdfplumber.open(local_path) as pdf:
        text = "\n".join([page.extract_text() for page in pdf.pages])
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–æ–º–µ—Ä –∞–∫—Ç–∞ –∏ –¥–∞—Ç—É
    act_number = re.search(r'–ê–ò–î[- ]?\d+', text)
    act_date = re.search(r'\d{2}\.\d{2}\.\d{4}', text)
    
    cursor = conn.cursor()
    cursor.execute("""
        INSERT INTO aid_acts 
        (act_number, act_date, status, pdf_file_path, needs_review)
        VALUES (%s, %s, 'draft', %s, TRUE)
    """, (
        act_number.group() if act_number else 'UNKNOWN',
        act_date.group() if act_date else None,
        file_path
    ))
    
    cursor.execute("""
        INSERT INTO processed_files 
        (file_path, file_type, status, created_records, processed_at, extracted_data)
        VALUES (%s, 'pdf', 'processed', 1, NOW(), %s)
    """, (
        file_path,
        json.dumps({'act_number': act_number.group() if act_number else None})
    ))
    
    conn.commit()

# –ó–∞–ø—É—Å–∫ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
import schedule
schedule.every(5).minutes.do(scan_and_process)

while True:
    schedule.run_pending()
    time.sleep(1)
```

---

## 6. –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 6.1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ–Ω–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** –ò–¢–†

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

1. –ò–¢–† –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç https://app.structura-most.ru/shift-tasks/create
2. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É:
   - –î–∞—Ç–∞ —Å–º–µ–Ω—ã: `05.01.2025`
   - –ó–∞—Ö–≤–∞—Ç–∫–∞: –≤—ã–±–∏—Ä–∞–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ `–≠—Ç–∞–∂ 5, –û—Å—å A-B`
   - –ë—Ä–∏–≥–∞–¥–∞: –≤—ã–±–∏—Ä–∞–µ—Ç `–ë—Ä–∏–≥–∞–¥–∞ ‚Ññ2 (–ú–æ–Ω—Ç–∞–∂)`
   - –í–∏–¥ —Ä–∞–±–æ—Ç: –≤—ã–±–∏—Ä–∞–µ—Ç `–ú–æ–Ω—Ç–∞–∂ –∫–æ–ª–æ–Ω–Ω`
3. –ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É **"–ü—Ä–∏–≤—è–∑–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –º–æ–¥–µ–ª–∏"**
4. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è BIM Viewer:
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –º–æ–¥–µ–ª—å –∏–∑ Speckle
   - –§–∏–ª—å—Ç—Ä—É—é—Ç—Å—è —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞—Ö–≤–∞—Ç–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - –ò–¢–† –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫–æ–ª–æ–Ω–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–π–¥—É—Ç –≤ –∑–∞–¥–∞–Ω–∏–µ
   - –≠–ª–µ–º–µ–Ω—Ç—ã –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç—Å—è –∂–µ–ª—Ç—ã–º
5. –ò–¢–† –Ω–∞–∂–∏–º–∞–µ—Ç **"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ"**
6. –°–∏—Å—Ç–µ–º–∞:
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `shift_tasks`
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ `shift_task_elements` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ GUID
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF –∑–∞–¥–∞–Ω–∏—è (–≤ –±—Ä–∞—É–∑–µ—Ä–µ)
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç PDF –≤ Nextcloud `/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–°–º–µ–Ω–Ω—ã–µ_–∑–∞–¥–∞–Ω–∏—è/–ó–∞–¥–∞–Ω–∏–µ_15.pdf`
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—É—Ç—å –∫ PDF –≤ –ë–î
7. PDF –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏ –ø–µ—á–∞—Ç–∏
8. –ü—Ä–æ—Ä–∞–± –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞–Ω–∏–µ (—Ä–∞—Å–ø–µ—á–∞—Ç–∫–∞ –∏–ª–∏ –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ó–∞–¥–∞–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º–µ —Å–≤—è–∑–∞–Ω–æ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –º–æ–¥–µ–ª–∏
- PDF –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
- –ü–ª–∞–Ω–æ–≤—ã–µ –æ–±—ä–µ–º—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã

---

### 6.2. –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** –ò–¢–†/–ü—Ä–æ—Ä–∞–±

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç https://app.structura-most.ru/shift-tasks
2. –ù–∞—Ö–æ–¥–∏—Ç –∑–∞–¥–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–µ/–±—Ä–∏–≥–∞–¥–µ
3. –ù–∞–∂–∏–º–∞–µ—Ç **"–û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ"**
4. –í–≤–æ–¥–∏—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–º: `8.5 —Ç` (–ø–ª–∞–Ω –±—ã–ª `10 —Ç`)
5. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ—Ç–º–µ—á–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (–≤ BIM Viewer)
6. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç
7. –°–∏—Å—Ç–µ–º–∞:
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `shift_tasks.actual_volume`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `shift_task_elements.completed = TRUE`
   - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞—à–±–æ—Ä–¥ "–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ"

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –§–∞–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω
- –í–∏–¥–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–ø–ª–∞–Ω vs —Ñ–∞–∫—Ç)
- –≠–ª–µ–º–µ–Ω—Ç—ã –≤ BIM Viewer –º–µ–Ω—è—é—Ç —Ü–≤–µ—Ç (–∑–µ–ª–µ–Ω—ã–π = –≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

---

### 6.3. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–∫—Ç–æ–≤ –ê–ò–î

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** –ò–Ω–∂–µ–Ω–µ—Ä

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ PDF**

1. –ò–Ω–∂–µ–Ω–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∞–∫—Ç—ã –≤ Nextcloud:
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç https://cloud.structura-most.ru
   - –ò–¥–µ—Ç –≤ `/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–ê–∫—Ç—ã/`
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã `–ê–∫—Ç_001.pdf`, `–ê–∫—Ç_002.pdf`, ...
2. File Processor (—á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç):
   - –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ PDF
   - –ò—â–µ—Ç –Ω–æ–º–µ—Ä–∞ –∞–∫—Ç–æ–≤, –¥–∞—Ç—ã (—Ä–µ–≥—É–ª—è—Ä–∫–∞–º–∏)
   - –°–æ–∑–¥–∞–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –≤ `aid_acts` (status='draft', needs_review=TRUE)
3. Refine –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: **"3 –Ω–æ–≤—ã—Ö –∞–∫—Ç–∞ —Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏"**
4. –ò–Ω–∂–µ–Ω–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç https://app.structura-most.ru/aid-acts?status=draft
5. –í–∏–¥–∏—Ç —Ç–∞–±–ª–∏—Ü—É —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤:
   ```
   ‚Ññ –∞–∫—Ç–∞ (—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω) | –î–∞—Ç–∞ (—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞) | –§–∞–π–ª
   –ê–ò–î-001           | 15.01.2025        | [–û—Ç–∫—Ä—ã—Ç—å PDF]
   UNKNOWN           | 16.01.2025        | [–û—Ç–∫—Ä—ã—Ç—å PDF]
   ```
6. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–∞:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç/–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–º–µ—Ä
   - –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ä—è–¥—á–∏–∫–∞ (—Ä—É—á–Ω–æ–π –≤–≤–æ–¥)
   - –í—ã–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç—É—Å: `–ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏` / `–£—Ç–≤–µ—Ä–∂–¥–µ–Ω`
   - –ù–∞–∂–∏–º–∞–µ—Ç **"–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ –º–æ–¥–µ–ª–∏"**
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è BIM Viewer ‚Üí –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç
7. –ê–∫—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å `approved`

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –†—É—á–Ω–æ–π –≤–≤–æ–¥**

1. –ò–Ω–∂–µ–Ω–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç https://app.structura-most.ru/aid-acts/create
2. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –≤—Ä—É—á–Ω—É—é:
   - –ù–æ–º–µ—Ä –∞–∫—Ç–∞
   - –î–∞—Ç–∞
   - –ü–æ–¥—Ä—è–¥—á–∏–∫
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç PDF (–∫–Ω–æ–ø–∫–∞ ‚Üí –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞ ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –≤ Nextcloud)
3. –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º —á–µ—Ä–µ–∑ BIM Viewer
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ê–∫—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ
- –°–≤—è–∑–∞–Ω —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –º–æ–¥–µ–ª–∏ (—á–µ—Ä–µ–∑ GUID)
- PDF –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- –í BIM Viewer —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∞–∫—Ç–∞–º–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∑–µ–ª–µ–Ω—ã–º

---

### 6.4. –ê–Ω–∞–ª–∏–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (–ø–ª–∞–Ω vs —Ñ–∞–∫—Ç)

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å/–ò–Ω–∂–µ–Ω–µ—Ä

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç https://app.structura-most.ru/materials
2. –í–∏–¥–∏—Ç —Ç–∞–±–ª–∏—Ü—É —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:
   ```
   –ú–∞—Ç–µ—Ä–∏–∞–ª | –ó–∞—Ö–≤–∞—Ç–∫–∞ | –ü–ª–∞–Ω (—Å–º–µ—Ç–∞) | –ü–ª–∞–Ω (–†–î) | –§–∞–∫—Ç (1–°) | –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
   –ë–µ—Ç–æ–Ω B25 | –≠—Ç–∞–∂ 5   | 120 –º¬≥       | 118 –º¬≥    | 125 –º¬≥    | +5 –º¬≥ üî¥
   –ê—Ä–º–∞—Ç—É—Ä–∞  | –≠—Ç–∞–∂ 5   | 15 —Ç         | 14.8 —Ç    | 14.2 —Ç    | -0.8 —Ç üü¢
   ```
3. –ö–ª–∏–∫–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–æ–∫—É —Å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ–º
4. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è:
   - –ö–∞–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ—Ç—Ä–µ–±–ª—è–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª
   - –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—Ö–æ–¥–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
   - –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞
   - –°—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (—Å–º–µ—Ç–∞ Excel, –≤—ã–≥—Ä—É–∑–∫–∞ 1–°)
5. –ú–æ–∂–µ—Ç —Ä–∞—Å–∫—Ä—ã—Ç—å –º–æ–¥–µ–ª—å –≤ BIM Viewer:
   - –≠–ª–µ–º–µ–Ω—Ç—ã —Ä–∞—Å–∫—Ä–∞—à–µ–Ω—ã –ø–æ —É—Ä–æ–≤–Ω—é —Ä–∞—Å—Ö–æ–¥–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í–∏–¥–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –Ω–∞ —Ä–∞–Ω–Ω–µ–π —Å—Ç–∞–¥–∏–∏
- –ú–æ–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

---

### 6.5. –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞—à–±–æ—Ä–¥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç https://app.structura-most.ru/dashboard
2. –í–∏–¥–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ KPI:
   - **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ –∑–∞—Ö–≤–∞—Ç–∫–∞–º:**
     ```
     –≠—Ç–∞–∂ 5: 85% ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë
     –≠—Ç–∞–∂ 6: 45% ‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
     ```
   - **–û—Ç—Å—Ç–∞—é—â–∏–µ –±—Ä–∏–≥–∞–¥—ã:**
     ```
     –ë—Ä–∏–≥–∞–¥–∞ ‚Ññ3: -15% –æ—Ç –ø–ª–∞–Ω–∞
     ```
   - **–ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:**
     ```
     –ë–µ—Ç–æ–Ω: +5%
     –ê—Ä–º–∞—Ç—É—Ä–∞: -3%
     ```
   - **–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
     ```
     –ó–∞–∫—Ä—ã—Ç–æ –∞–∫—Ç–∞–º–∏: 70%
     –¢—Ä–µ–±—É–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è: 30%
     ```
3. –ö–ª–∏–∫–∞–µ—Ç –Ω–∞ –≥—Ä–∞—Ñ–∏–∫ ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è
4. –ú–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –≤ BIM Viewer –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- –ë—ã—Å—Ç—Ä–æ–µ –≤—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

---

## 7. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ (File Processor)

### 7.1. –û–±—â–∞—è —Å—Ö–µ–º–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª –≤ Nextcloud
              ‚Üì
File Processor (—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω)
              ‚Üì
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
              ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚Üì                    ‚Üì
Excel Parser        PDF Parser
    ‚Üì                    ‚Üì
–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö    OCR (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    ‚Üì                    ‚Üì
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚Üì
–°–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –≤ PostgreSQL
(needs_review = TRUE)
              ‚Üì
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Refine
              ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç/–¥–æ–ø–æ–ª–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
              ‚Üì
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏
```

### 7.2. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

#### **Excel (.xlsx)**

**–ß—Ç–æ –∏–∑–≤–ª–µ–∫–∞–µ–º:**
- –°–º–µ—Ç—ã: –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –æ–±—ä–µ–º—ã, —Å—Ç–æ–∏–º–æ—Å—Ç—å
- –í–µ–¥–æ–º–æ—Å—Ç–∏: –ø–æ–∑–∏—Ü–∏–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏: —ç–ª–µ–º–µ–Ω—Ç—ã, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** pandas, openpyxl

**–ü—Ä–∏–º–µ—Ä:**
```python
def process_estimate_excel(file_path):
    df = pd.read_excel(file_path, sheet_name='–ú–∞—Ç–µ—Ä–∏–∞–ª—ã')
    
    for _, row in df.iterrows():
        conn.execute("""
            INSERT INTO materials_estimate 
            (estimate_position, material_id, planned_volume, cost_per_unit, source_file)
            VALUES (%s, 
                    (SELECT id FROM materials WHERE name ILIKE %s), 
                    %s, %s, %s)
        """, (
            row['–ü–æ–∑–∏—Ü–∏—è'],
            row['–ú–∞—Ç–µ—Ä–∏–∞–ª'],
            row['–û–±—ä–µ–º'],
            row['–¶–µ–Ω–∞ –∑–∞ –µ–¥.'],
            file_path
        ))
```

---

#### **PDF (—Ç–µ–∫—Å—Ç–æ–≤—ã–π)**

**–ß—Ç–æ –∏–∑–≤–ª–µ–∫–∞–µ–º:**
- –ù–æ–º–µ—Ä–∞ –∞–∫—Ç–æ–≤, –ö–°-2
- –î–∞—Ç—ã
- –ü–æ–¥–ø–∏—Å–∏ (–ø–æ–¥—Ä—è–¥—á–∏–∫, –∑–∞–∫–∞–∑—á–∏–∫)

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** pdfplumber

**–ü—Ä–∏–º–µ—Ä:**
```python
def process_act_pdf(file_path):
    with pdfplumber.open(file_path) as pdf:
        text = "\n".join([p.extract_text() for p in pdf.pages])
    
    # –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
    act_number = re.search(r'–ê–ò–î[- ]?(\d+)', text)
    act_date = re.search(r'(\d{2}\.\d{2}\.\d{4})', text)
    contractor = re.search(r'–ü–æ–¥—Ä—è–¥—á–∏–∫:\s*(.+)', text)
    
    conn.execute("""
        INSERT INTO aid_acts 
        (act_number, act_date, contractor, status, pdf_file_path, needs_review)
        VALUES (%s, %s, %s, 'draft', %s, TRUE)
    """, (
        act_number.group(1) if act_number else None,
        act_date.group(1) if act_date else None,
        contractor.group(1) if contractor else None,
        file_path
    ))
```

---

#### **PDF (—Å–∫–∞–Ω) - OCR**

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** tesseract-ocr, pdf2image

**–ü—Ä–∏–º–µ—Ä:**
```python
from pdf2image import convert_from_path
import pytesseract

def process_scanned_pdf(file_path):
    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º PDF –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    images = convert_from_path(file_path)
    
    # OCR –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    text = ""
    for img in images:
        text += pytesseract.image_to_string(img, lang='rus')
    
    # –î–∞–ª—å—à–µ –∫–∞–∫ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º PDF
    process_act_pdf_text(text, file_path)
```

---

#### **CSV (–≤—ã–≥—Ä—É–∑–∫–∏ –∏–∑ 1–°)**

**–ß—Ç–æ –∏–∑–≤–ª–µ–∫–∞–µ–º:**
- –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- –î–∞—Ç—ã, –¥–æ–∫—É–º–µ–Ω—Ç—ã

**–ü—Ä–∏–º–µ—Ä:**
```python
def process_1c_csv(file_path):
    df = pd.read_csv(file_path, encoding='cp1251', sep=';')
    
    for _, row in df.iterrows():
        conn.execute("""
            INSERT INTO materials_actual 
            (material_id, zone_id, write_off_date, volume, s1c_document_number)
            VALUES (
                (SELECT id FROM materials WHERE code = %s),
                (SELECT id FROM zones WHERE code = %s),
                %s, %s, %s
            )
        """, (
            row['–ö–æ–¥ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã'],
            row['–û–±—ä–µ–∫—Ç'],
            row['–î–∞—Ç–∞'],
            row['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'],
            row['–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞']
        ))
```

---

### 7.3. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
import schedule
import time

def scan_folders():
    folders = {
        '/files/admin/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–ê–∫—Ç—ã': 'act_pdf',
        '/files/admin/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/–°–º–µ—Ç—ã': 'estimate_excel',
        '/files/admin/–ü—Ä–æ–µ–∫—Ç—ã/–ú–ì–£/1C': '1c_csv'
    }
    
    for folder, file_type in folders.items():
        files = nextcloud.list(folder)
        
        for file_info in files:
            file_path = file_info['path']
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ª–∏ —É–∂–µ
            cursor = conn.cursor()
            cursor.execute(
                "SELECT id FROM processed_files WHERE file_path = %s",
                (file_path,)
            )
            if cursor.fetchone():
                continue
            
            # –°–∫–∞—á–∏–≤–∞–µ–º –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
            local_path = download_file(file_path)
            
            try:
                if file_type == 'act_pdf':
                    process_act_pdf(local_path, file_path)
                elif file_type == 'estimate_excel':
                    process_estimate_excel(local_path, file_path)
                elif file_type == '1c_csv':
                    process_1c_csv(local_path, file_path)
                
                # –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—Ö
                log_processed_file(file_path, 'processed')
            except Exception as e:
                # –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
                log_processed_file(file_path, 'error', str(e))

# –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
schedule.every(5).minutes.do(scan_folders)

while True:
    schedule.run_pending()
    time.sleep(1)
```

---

## 8. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 8.1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ:**
- CPU: 4 core
- RAM: 8 GB
- –î–∏—Å–∫: 100 GB SSD
- OS: Ubuntu 20.04+ / Debian 11+

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ:**
- CPU: 6 core
- RAM: 16 GB
- –î–∏—Å–∫: 250 GB SSD

### 8.2. Docker Compose —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
structura/
‚îú‚îÄ docker/
‚îÇ  ‚îú‚îÄ docker-compose.base.yml      (–ë–î, Redis, MinIO)
‚îÇ  ‚îú‚îÄ docker-compose.speckle.yml   (Speckle —Å–µ—Ä–≤–∏—Å—ã)
‚îÇ  ‚îú‚îÄ docker-compose.nextcloud.yml (Nextcloud)
‚îÇ  ‚îú‚îÄ docker-compose.structura.yml (PostgREST, Refine, File Processor)
‚îÇ  ‚îî‚îÄ docker-compose.prod.yml      (Traefik, Grafana)
‚îú‚îÄ backend/
‚îÇ  ‚îú‚îÄ file_processor/
‚îÇ  ‚îÇ  ‚îú‚îÄ worker.py
‚îÇ  ‚îÇ  ‚îú‚îÄ parsers/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ excel_parser.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ pdf_parser.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ csv_parser.py
‚îÇ  ‚îÇ  ‚îî‚îÄ requirements.txt
‚îÇ  ‚îî‚îÄ Dockerfile
‚îú‚îÄ frontend/
‚îÇ  ‚îú‚îÄ src/
‚îÇ  ‚îÇ  ‚îú‚îÄ pages/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ shift-tasks/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ aid-acts/
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ materials/
‚îÇ  ‚îÇ  ‚îú‚îÄ components/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ BIMViewer.tsx
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ ...
‚îÇ  ‚îÇ  ‚îî‚îÄ App.tsx
‚îÇ  ‚îú‚îÄ package.json
‚îÇ  ‚îî‚îÄ Dockerfile
‚îú‚îÄ database/
‚îÇ  ‚îú‚îÄ migrations/
‚îÇ  ‚îÇ  ‚îú‚îÄ 001_init.sql
‚îÇ  ‚îÇ  ‚îú‚îÄ 002_shift_tasks.sql
‚îÇ  ‚îÇ  ‚îú‚îÄ 003_aid_acts.sql
‚îÇ  ‚îÇ  ‚îî‚îÄ 004_materials.sql
‚îÇ  ‚îî‚îÄ seeds/
‚îÇ     ‚îî‚îÄ initial_data.sql
‚îú‚îÄ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è/
‚îÇ  ‚îú‚îÄ –ú–æ–¥—É–ª—å_1._—Å–º–µ–Ω–Ω–æ–µ_–∑–∞–¥–∞–Ω–∏–µ.pdf
‚îÇ  ‚îú‚îÄ –ú–æ–¥—É–ª—å_2._—Ä–µ–µ—Å—Ç—Ä_–∞–∫—Ç–æ–≤.pdf
‚îÇ  ‚îî‚îÄ ...
‚îú‚îÄ .gitignore
‚îú‚îÄ README.md
‚îî‚îÄ –ê–†–•–ò–¢–ï–ö–¢–£–†–ê_–°–ò–°–¢–ï–ú–´.md (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
```

### 8.3. –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo_url>
cd structura

# 2. –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª–∏ –∏ –¥–æ–º–µ–Ω—ã

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
cd docker
docker-compose -f docker-compose.base.yml up -d

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å Speckle
docker-compose -f docker-compose.speckle.yml up -d

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å Nextcloud
docker-compose -f docker-compose.nextcloud.yml up -d

# 6. –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö structura
docker exec -it postgres_speckle psql -U speckle
CREATE DATABASE structura;
\c structura
\i /migrations/001_init.sql

# 7. –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgREST, File Processor, Refine
docker-compose -f docker-compose.structura.yml up -d

# 8. –ó–∞–ø—É—Å—Ç–∏—Ç—å Traefik (production)
docker-compose -f docker-compose.prod.yml up -d
```

### 8.4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker logs -f file-processor
docker logs -f postgrest
docker logs -f refine-app

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤
docker ps
```

### 8.5. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ë—ç–∫–∞–ø PostgreSQL
docker exec postgres_speckle pg_dump -U speckle structura > backup_$(date +%Y%m%d).sql

# –ë—ç–∫–∞–ø Nextcloud —Ñ–∞–π–ª–æ–≤
rsync -av data/nextcloud/ /backup/nextcloud/

# –ë—ç–∫–∞–ø MinIO (S3)
mc mirror minio/speckle-server /backup/minio/
```

---

## 9. Roadmap —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –§–∞–∑–∞ 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (1 –Ω–µ–¥–µ–ª—è)

- [ ] –û—á–∏—Å—Ç–∫–∞ Docker Compose (—É–¥–∞–ª–µ–Ω–∏–µ BIMserver, xeokit)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ PostgREST
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö `structura`
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã –ë–î
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ File Processor (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)

### –§–∞–∑–∞ 2: –ú–æ–¥—É–ª—å "–°–º–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ" (2 –Ω–µ–¥–µ–ª–∏)

- [ ] –°–æ–∑–¥–∞–Ω–∏–µ Refine –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –¢–∞–±–ª–∏—Ü—ã: –∑–æ–Ω—ã, –±—Ä–∏–≥–∞–¥—ã, –≤–∏–¥—ã —Ä–∞–±–æ—Ç
- [ ] –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è BIM Viewer (–≤—ã–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –∑–∞–¥–∞–Ω–∏—è
- [ ] –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –§–∞–∑–∞ 3: –ú–æ–¥—É–ª—å "–ê–∫—Ç—ã –ê–ò–î" (1-2 –Ω–µ–¥–µ–ª–∏)

- [ ] –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫—Ç–∞
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ PDF –≤ Nextcloud
- [ ] –ê–≤—Ç–æ–æ–±—Ä–∞–±–æ—Ç–∫–∞ PDF (OCR, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
- [ ] –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º –º–æ–¥–µ–ª–∏
- [ ] –†–µ–µ—Å—Ç—Ä –∞–∫—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

### –§–∞–∑–∞ 4: –ú–æ–¥—É–ª—å "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã" (2-3 –Ω–µ–¥–µ–ª–∏)

- [ ] –ü–∞—Ä—Å–∏–Ω–≥ Excel —Å–º–µ—Ç
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π Tekla
- [ ] –ò–º–ø–æ—Ä—Ç –≤—ã–≥—Ä—É–∑–æ–∫ 1–°
- [ ] –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–ª–∞–Ω-—Ñ–∞–∫—Ç
- [ ] –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π –≤ BIM Viewer

### –§–∞–∑–∞ 5: –î–∞—à–±–æ—Ä–¥—ã (1 –Ω–µ–¥–µ–ª—è)

- [ ] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Grafana
- [ ] SQL Views –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- [ ] –î–∞—à–±–æ—Ä–¥ "–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ"
- [ ] –î–∞—à–±–æ—Ä–¥ "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã"
- [ ] –î–∞—à–±–æ—Ä–¥ "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"

### –§–∞–∑–∞ 6: –î–æ—Ä–∞–±–æ—Ç–∫–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (2-4 –Ω–µ–¥–µ–ª–∏)

- [ ] –£–ª—É—á—à–µ–Ω–∏–µ File Processor (—Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è)
- [ ] –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è UI
- [ ] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (—Ä–æ–ª–∏: –ò–¢–†, –∏–Ω–∂–µ–Ω–µ—Ä, —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (email, Telegram)
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤

**–ò—Ç–æ–≥–æ:** 3-4 –º–µ—Å—è—Ü–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## 10. –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** [–í–∞—à–µ –∏–º—è]  
**Email:** [email]  
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** [GitHub URL]

---

**–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** 31.12.2024  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 31.12.2024
