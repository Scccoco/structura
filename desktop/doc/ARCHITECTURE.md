# Structura Desktop â€” Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

> **Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Ğ¡Ğ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¾  
> **Ğ”Ğ°Ñ‚Ğ°:** 2026-01-28

---

## 1. ĞĞ±Ñ‰Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Ğ’ĞĞ¨ Ğ¡Ğ•Ğ Ğ’Ğ•Ğ  (structura-most.ru)                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚ Speckle  â”‚   â”‚ Frontend â”‚   â”‚ Backend  â”‚   â”‚ PostgreSQL       â”‚         â”‚
â”‚   â”‚ Server   â”‚   â”‚ (Web)    â”‚   â”‚ API      â”‚   â”‚ (structura DB)   â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                              â–²                                               â”‚
â”‚                              â”‚ Ğ˜Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñƒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Ğ¡Ğ•Ğ¢Ğ•Ğ’ĞĞ¯ ĞŸĞĞŸĞšĞ \\server\share\Structura\                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ releases/       â”‚   â”‚ model-cache/    â”‚   â”‚ sync/                   â”‚   â”‚
â”‚   â”‚ (Ğ²ĞµÑ€ÑĞ¸Ğ¸ EXE)    â”‚   â”‚ (ĞºÑÑˆ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹)   â”‚   â”‚ â”œâ”€ events.jsonl         â”‚   â”‚
â”‚   â”‚                 â”‚   â”‚                 â”‚   â”‚ â””â”€ snapshots/           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚   â”‚ locks/          â”‚  â† Lock-Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚                      â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ Ğ®Ğ·ĞµÑ€ 1  â”‚            â”‚ Ğ®Ğ·ĞµÑ€ 2  â”‚            â”‚  ĞĞ´Ğ¼Ğ¸Ğ½  â”‚
   â”‚ (Ğ½ĞµÑ‚ğŸŒ) â”‚            â”‚ (Ğ½ĞµÑ‚ğŸŒ) â”‚            â”‚ (ĞµÑÑ‚ÑŒğŸŒ)â”‚
   â”‚         â”‚            â”‚         â”‚            â”‚         â”‚
   â”‚ Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñâ”‚            â”‚ Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñâ”‚            â”‚ Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñâ”‚
   â”‚ SQLite   â”‚            â”‚ SQLite   â”‚            â”‚ SQLite   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

### 2.1 ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ A1)

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Ğ“Ğ´Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ | Ğ—Ğ°Ñ‡ĞµĞ¼ |
|-----------|--------------|-------|
| **Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ‘Ğ”** | `%LOCALAPPDATA%\Structura\data\structura.db` | Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿, Ğ½ĞµÑ‚ Ñ€Ğ¸ÑĞºĞ° Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ |
| **Event log** | `\\server\share\Structura\sync\events\events-<user>.jsonl` | Per-user Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ |
| **Snapshots** | `\\server\share\Structura\sync\snapshots\*.zip` | Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚ (ZIP + manifest) |
| **Model cache** | `\\server\share\Structura\model-cache\` | ĞĞ±Ñ‰Ğ¸Ğ¹ ĞºÑÑˆ 3D Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ |
| **Locks** | `\\server\share\Structura\locks\` | Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (rename-Ñ‚Ñ€ÑĞº) |

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ½Ğµ Ğ¾Ğ´Ğ¸Ğ½ SQLite Ğ½Ğ° ÑˆĞ°Ñ€Ğµ:**
- SQLite + SMB = Ğ½ĞµÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ, Ñ€Ğ¸ÑĞº Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ
- ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‰Ğ¸ĞºĞ°Ğ¼ Ğ´Ğ»Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
- Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ‘Ğ” + ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹Ğ½Ğ°Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ = Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½Ğ¾

### 2.2 Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ±ĞµĞ· ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ (Launcher)

```
\\server\share\Structura\
â”œâ”€â”€ StructuraLauncher.exe        â† ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ ÑÑ‚Ğ¾
â”œâ”€â”€ releases/
â”‚   â”œâ”€â”€ 1.0.0/                   â† ĞŸĞ°Ğ¿ĞºĞ° Ñ EXE Ğ²ĞµÑ€ÑĞ¸Ğ¸ 1.0.0
â”‚   â”œâ”€â”€ 1.0.1/
â”‚   â””â”€â”€ 1.0.2/                   â† ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ²ĞµÑ€ÑĞ¸Ñ
â””â”€â”€ current_version.txt          â† Ğ£ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ° Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½ÑƒÑ Ğ²ĞµÑ€ÑĞ¸Ñ

%LOCALAPPDATA%\Structura\
â”œâ”€â”€ app/
â”‚   â””â”€â”€ 1.0.2/                   â† Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
â”‚       â””â”€â”€ Structura.exe
â”œâ”€â”€ data/
â”‚   â””â”€â”€ structura.db             â† Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ‘Ğ” Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
â””â”€â”€ update.lock                  â† Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ½Ğ° Ğ²Ñ€ĞµĞ¼Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
```

**ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:**
1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ `StructuraLauncher.exe`
2. Launcher Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ `current_version.txt`
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ `update.lock` â€” ĞµÑĞ»Ğ¸ Ğ·Ğ°Ğ½ÑÑ‚, Ğ¶Ğ´Ñ‘Ñ‚ (retry Ñ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚Ğ¾Ğ¼)
4. ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½ÑƒĞ¶Ğ½ÑƒÑ Ğ²ĞµÑ€ÑĞ¸Ñ Ğ² **Ğ½Ğ¾Ğ²ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ** `%LOCALAPPDATA%\app\<version>/`
5. Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ `local_version.txt`
6. Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ `Structura.exe`

**ĞÑ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ:**
```
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ update.lock (exclusive mode)
2. Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ releases/1.0.3/ â†’ app/1.0.3.tmp/
3. ĞŸĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ñ‚ÑŒ app/1.0.3.tmp/ â†’ app/1.0.3/
4. Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ "1.0.3" Ğ² local_version.txt
5. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ update.lock
6. (ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ²ĞµÑ€ÑĞ¸Ğ¸ app/1.0.0/, app/1.0.1/
```

**Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ³Ğ¾Ğ½Ğ¾Ğº:**
```typescript
// Launcher update logic
async function acquireUpdateLock(): Promise<boolean> {
    const lockPath = path.join(LOCAL_DATA, 'update.lock');
    const maxRetries = 5;
    const retryDelay = 2000; // 2 ÑĞµĞº
    
    for (let i = 0; i < maxRetries; i++) {
        try {
            // Exclusive create â€” ĞµÑĞ»Ğ¸ Ñ„Ğ°Ğ¹Ğ» ĞµÑÑ‚ÑŒ, Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°
            fs.writeFileSync(lockPath, process.pid.toString(), { flag: 'wx' });
            return true;
        } catch (e) {
            // Ğ¤Ğ°Ğ¹Ğ» Ğ·Ğ°Ğ½ÑÑ‚ â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚
            const stat = fs.statSync(lockPath);
            const ageMs = Date.now() - stat.mtimeMs;
            if (ageMs > 5 * 60 * 1000) { // ĞŸÑ€Ğ¾Ñ‚ÑƒÑ… (5 Ğ¼Ğ¸Ğ½)
                fs.unlinkSync(lockPath);
                continue;
            }
            await sleep(retryDelay);
        }
    }
    return false; // ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ lock
}
```

**ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ¼:**
- ĞšĞ»Ğ°Ğ´Ñ‘Ñ‚ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ Ğ² `releases/1.0.3/`
- ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ `current_version.txt`
- ĞŸÑ€Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ launcher Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ğ½Ğ¾Ğ²ÑƒÑ Ğ²ĞµÑ€ÑĞ¸Ñ Ğ¸ ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- ĞĞµ Ğ½ÑƒĞ¶Ğ½Ñ‹ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°
- EXE Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ñ ÑˆĞ°Ñ€Ñ‹ â†’ Ğ½ĞµÑ‚ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº
- ĞÑ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ â€” Ğ½ĞµÑ‚ "Ğ¿Ğ¾Ğ»ÑƒÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ…" ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹
- Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ

### 2.3 Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (Lock-Ñ„Ğ°Ğ¹Ğ»Ñ‹)

```
\\server\share\Structura\locks\
â”œâ”€â”€ module_vedomost1.lock.json
â”œâ”€â”€ module_vedomost2.lock.json
â”œâ”€â”€ module_aid.lock.json
â””â”€â”€ admin.lock.json              â† Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ â€” Ğ²ÑÑ‘ read-only (Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚!)
```

**Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ lock-Ñ„Ğ°Ğ¹Ğ»Ğ°:**
```json
{
    "locked_by": "ivanov",
    "locked_at": "2026-01-28T14:30:00Z",
    "heartbeat": "2026-01-28T14:35:00Z",
    "module": "vedomost1"
}
```

**ĞÑ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ lock (rename-Ñ‚Ñ€ÑĞº):**
```typescript
async function acquireModuleLock(module: string, user: string): Promise<boolean> {
    const locksDir = '\\\\server\\share\\Structura\\locks';
    const lockFile = path.join(locksDir, `module_${module}.lock.json`);
    const tmpFile = path.join(locksDir, `module_${module}.lock.tmp.${user}`);
    
    // 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ admin.lock â€” ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ, ÑÑ€Ğ°Ğ·Ñƒ read-only
    if (fs.existsSync(path.join(locksDir, 'admin.lock.json'))) {
        return false; // ĞĞ´Ğ¼Ğ¸Ğ½ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ» Ğ²ÑÑ‘
    }
    
    // 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ lock
    if (fs.existsSync(lockFile)) {
        const existing = JSON.parse(fs.readFileSync(lockFile, 'utf-8'));
        const heartbeatAge = Date.now() - new Date(existing.heartbeat).getTime();
        const GRACE_WINDOW = 90 * 1000; // 90 ÑĞµĞº grace
        
        if (heartbeatAge < GRACE_WINDOW) {
            // Lock Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½
            return false;
        }
        // Lock Ğ¿Ñ€Ğ¾Ñ‚ÑƒÑ… â€” ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼
        fs.unlinkSync(lockFile);
    }
    
    // 3. Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»
    const lockData = {
        locked_by: user,
        locked_at: new Date().toISOString(),
        heartbeat: new Date().toISOString(),
        module: module
    };
    fs.writeFileSync(tmpFile, JSON.stringify(lockData));
    
    // 4. ĞÑ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ñ‹Ğ¹ rename
    try {
        fs.renameSync(tmpFile, lockFile);
        return true;
    } catch (e) {
        // ĞšÑ‚Ğ¾-Ñ‚Ğ¾ Ğ¾Ğ¿ĞµÑ€ĞµĞ´Ğ¸Ğ»
        fs.unlinkSync(tmpFile);
        return false;
    }
}
```

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
1. ĞŸÑ€Ğ¸ Ğ²Ñ…Ğ¾Ğ´Ğµ Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ â†’ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ `admin.lock.json`
2. Ğ•ÑĞ»Ğ¸ admin lock ĞµÑÑ‚ÑŒ â†’ **Ğ²ÑÑ‘ read-only**, Ğ´Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ±Ñ‹Ğ» Ğ·Ğ°Ğ½ÑÑ‚
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ lock-Ñ„Ğ°Ğ¹Ğ» Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
4. Ğ•ÑĞ»Ğ¸ heartbeat < 90 ÑĞµĞº Ğ½Ğ°Ğ·Ğ°Ğ´ â†’ "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ·Ğ°Ğ½ÑÑ‚: Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²"
5. Ğ•ÑĞ»Ğ¸ heartbeat Ğ¿Ñ€Ğ¾Ñ‚ÑƒÑ… â†’ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ (ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¹)
6. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· rename-Ñ‚Ñ€ÑĞº (Ğ°Ñ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾)
7. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ heartbeat ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 15-20 ÑĞµĞº
8. ĞŸÑ€Ğ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğµ â†’ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ lock-Ñ„Ğ°Ğ¹Ğ»

**ĞĞ´Ğ¼Ğ¸Ğ½ÑĞºĞ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° (Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ Ğ½Ğ°Ğ´ Ğ²ÑĞµĞ¼):**
- ĞĞ´Ğ¼Ğ¸Ğ½ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ `admin.lock.json`
- **Ğ’ÑĞµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ ÑÑ€Ğ°Ğ·Ñƒ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‚ Ğ² read-only**, Ğ´Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ Ğ±Ñ‹Ğ»Ğ¸ Ğ·Ğ°Ğ½ÑÑ‚Ñ‹
- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ²Ğ¸Ğ´ÑÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ¼"
- ĞŸĞ¾ÑĞ»Ğµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½ ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚ `admin.lock.json`

---

## 3. Speckle Offline â€” ĞŸĞ»Ğ°Ğ½ Ğ¸Ğ·Ñ‹ÑĞºĞ°Ğ½Ğ¸Ğ¹

### 3.1 ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚

**Ğ¤Ğ°ĞºÑ‚Ñ‹ Ğ¸Ğ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Speckle:**
- Viewer Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‡ĞµÑ€ĞµĞ· Ğ°Ğ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ñ `Loader`
- ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¹ loader Ğ´Ğ»Ñ Ğ»ÑĞ±Ğ¾Ğ³Ğ¾ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°
- `@speckle/objectloader` â€” ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ° Ğ´Ğ»Ñ ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² Ğ¸ Ğ¿Ğ¾Ğ´ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²
- ĞĞµÑ‚ Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ offline Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°, Ğ½Ğ¾ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚

**Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ:** ~200 MB

### 3.2 Ğ­Ñ‚Ğ°Ğ¿Ñ‹ POC

#### Ğ­Ñ‚Ğ°Ğ¿ A: Ğ˜Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (30 Ğ¼Ğ¸Ğ½)

**Ğ¦ĞµĞ»ÑŒ:** Ğ—Ğ°Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ¾Ğ²ÑƒÑ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
- `streamId`: _______
- `commitId`: _______
- `referencedObject`: _______

---

#### Ğ­Ñ‚Ğ°Ğ¿ B: Cache Fetcher (1-2 Ñ‡Ğ°ÑĞ°)

**Ğ¦ĞµĞ»ÑŒ:** ĞĞ°ÑƒÑ‡Ğ¸Ñ‚ÑŒÑÑ ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ² Ğ¿Ğ°Ğ¿ĞºÑƒ

**Ğ’Ğ°Ğ¶Ğ½Ğ¾: Per-Object ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ**
- ĞĞ• ÑĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑÑ‘ Ğ² Ğ¾Ğ´Ğ¸Ğ½ `objects.json`
- 200 MB Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ â†’ 400-800 MB JSON â†’ UI Ğ·Ğ°Ğ²Ğ¸ÑĞ½ĞµÑ‚ Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸
- ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°Ğ¼ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ĞºÑÑˆĞ°:**
```
model-cache/<streamId>/<commitId>/
â”œâ”€â”€ manifest.json              # ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ + ÑĞ¿Ğ¸ÑĞ¾Ğº objectId
â””â”€â”€ objects/
    â”œâ”€â”€ <objectId1>.json
    â”œâ”€â”€ <objectId2>.json
    â””â”€â”€ ...
```

**Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ ObjectLoader:**
| ĞŸĞ°ĞºĞµÑ‚ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|--------|----------|--------|
| `@speckle/objectloader` | Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ° Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ° Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² | Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ |
| `@speckle/objectloader2` | ĞĞ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğ¹ Ğ´Ğ»Ñ viewer | ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ |

Ğ’ POC ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ğ°, Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ñ Ñ‚Ğ¾Ğ³Ğ¾ Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ñ‰Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ.

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
```typescript
// electron/services/model-cache.ts
import { ObjectLoader } from '@speckle/objectloader';

async function cacheModel(streamId: string, commitId: string, token: string) {
    const serverUrl = 'https://speckle.structura-most.ru';
    const cachePath = `\\\\server\\share\\Structura\\model-cache\\${streamId}\\${commitId}`;
    const objectsDir = path.join(cachePath, 'objects');
    
    fs.mkdirSync(objectsDir, { recursive: true });
    
    const objectId = await getReferencedObject(streamId, commitId, token);
    
    const loader = new ObjectLoader({
        serverUrl,
        streamId,
        objectId,
        token,
    });
    
    const objectIds: string[] = [];
    let count = 0;
    let totalSize = 0;
    
    // Per-object ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ
    for await (const obj of loader.getObjectIterator()) {
        const objJson = JSON.stringify(obj);
        const objPath = path.join(objectsDir, `${obj.id}.json`);
        fs.writeFileSync(objPath, objJson);
        
        objectIds.push(obj.id);
        totalSize += Buffer.byteLength(objJson);
        count++;
        
        if (count % 100 === 0) {
            console.log(`Downloaded ${count} objects (${(totalSize / 1024 / 1024).toFixed(1)} MB)`);
        }
    }
    
    // Manifest Ñ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
    fs.writeFileSync(path.join(cachePath, 'manifest.json'), JSON.stringify({
        streamId,
        commitId,
        rootObjectId: objectId,
        objectIds,
        objectCount: count,
        totalSizeBytes: totalSize,
        cachedAt: new Date().toISOString()
    }));
    
    console.log(`âœ… ĞœĞ¾Ğ´ĞµĞ»ÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ°: ${count} Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ², ${(totalSize / 1024 / 1024).toFixed(1)} MB`);
}
```

**ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ ÑƒÑĞ¿ĞµÑ…Ğ°:**
- ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¼ Ñ„Ğ°Ğ¹Ğ»Ğµ
- `manifest.json` ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº objectIds
- ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸

---

#### Ğ­Ñ‚Ğ°Ğ¿ C: Custom Loader (1-2 Ğ´Ğ½Ñ)

**Ğ¦ĞµĞ»ÑŒ:** Viewer Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¸Ğ· ĞºÑÑˆĞ°

**Ğ”Ğ²Ğ° Ğ¿ÑƒÑ‚Ğ¸:**

| ĞŸÑƒÑ‚ÑŒ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | ĞšĞ¾Ğ³Ğ´Ğ° Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ |
|------|----------|---------------|
| **Custom Loader** | ĞŸĞ¸ÑˆĞµĞ¼ ÑĞ²Ğ¾Ğ¹ Loader Ğ¿Ğ¾ API Speckle | ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ, ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğµ |
| **Proxy Ğ½Ğ° localhost** | Express Ğ¾Ñ‚Ğ´Ğ°Ñ‘Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ°Ğº Speckle API | Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚, ĞµÑĞ»Ğ¸ URL Ğ¼Ğ°Ğ»Ğ¾ |

**Custom Loader (ÑĞºĞµĞ»ĞµÑ‚):**
```typescript
// src/lib/LocalCacheLoader.ts
import { Loader, WorldTree, NodeData } from '@speckle/viewer';

export class LocalCacheLoader extends Loader {
    private cachePath: string;
    private worldTree: WorldTree;
    
    constructor(worldTree: WorldTree, cachePath: string) {
        super();
        this.worldTree = worldTree;
        this.cachePath = cachePath;
    }
    
    async load(): Promise<void> {
        const objectsPath = path.join(this.cachePath, 'objects.json');
        const data = JSON.parse(fs.readFileSync(objectsPath, 'utf-8'));
        
        // Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ WorldTree Ğ¸Ğ· ĞºÑÑˆĞ°
        for (const [id, obj] of Object.entries(data)) {
            // ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² TreeNode Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² WorldTree
            this.worldTree.addNode(this.convertToNode(obj));
        }
        
        // ĞŸĞ¾ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ RenderTree
        // ...
    }
    
    cancel(): void { /* ... */ }
    dispose(): void { /* ... */ }
    
    private convertToNode(obj: any): NodeData {
        // ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Speckle Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ° Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ WorldTree
        // ...
    }
}
```

**Proxy Ñ‚ĞµÑÑ‚ (Ğ´Ğ»Ñ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ):**
```typescript
// Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ°ĞºĞ¸Ğµ URL Ğ·Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ SpeckleLoader
// Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ DevTools Network tab Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
// Ğ•ÑĞ»Ğ¸ URL Ğ¼Ğ°Ğ»Ğ¾ (1-3) â†’ proxy Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾
// Ğ•ÑĞ»Ğ¸ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ GraphQL/metadata â†’ custom loader Ğ»ÑƒÑ‡ÑˆĞµ
```

**ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ ÑƒÑĞ¿ĞµÑ…Ğ°:**
- ĞÑ‚ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚
- Viewer Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ³ĞµĞ¾Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ
- Ğ”ĞµÑ€ĞµĞ²Ğ¾ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ (Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾)

---

#### Ğ­Ñ‚Ğ°Ğ¿ D: Ğ”Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ Ğ±Ğ¾ĞµĞ²Ğ¾Ğ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ (2-5 Ğ´Ğ½ĞµĞ¹)

**ĞŸĞ¾ÑĞ»Ğµ POC:**
- Ğ’ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºÑÑˆĞ° Ğ¿Ğ¾ commitId
- Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ "ĞºÑÑˆ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ»"
- ĞÑ‚Ñ‡Ñ‘Ñ‚ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñƒ ĞºÑÑˆĞ°
- Ğ§Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ²ĞµÑ€ÑĞ¸Ğ¹
- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… ÑĞ»ÑƒÑ‡Ğ°ĞµĞ² (instancing, chunks)

---

## 4. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹ Ğ¿Ğ°Ğ¿ĞºĞ¸

```
\\server\share\Structura\
â”œâ”€â”€ StructuraLauncher.exe
â”œâ”€â”€ current_version.txt                    # "1.0.2"
â”‚
â”œâ”€â”€ releases/
â”‚   â”œâ”€â”€ 1.0.0/
â”‚   â”‚   â””â”€â”€ Structura.exe
â”‚   â”œâ”€â”€ 1.0.1/
â”‚   â””â”€â”€ 1.0.2/
â”‚       â””â”€â”€ Structura.exe
â”‚
â”œâ”€â”€ model-cache/
â”‚   â””â”€â”€ <streamId>/
â”‚       â””â”€â”€ <commitId>/
â”‚           â”œâ”€â”€ objects.json               # Ğ’ÑĞµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹
â”‚           â””â”€â”€ manifest.json              # ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
â”‚
â”œâ”€â”€ sync/
â”‚   â”œâ”€â”€ events/                            # Per-user event files
â”‚   â”‚   â”œâ”€â”€ events-ivanov.jsonl
â”‚   â”‚   â”œâ”€â”€ events-petrov.jsonl
â”‚   â”‚   â””â”€â”€ events-admin.jsonl
â”‚   â””â”€â”€ snapshots/
â”‚       â”œâ”€â”€ snapshot-20260128-143000.zip   # ZIP (db + manifest)
â”‚       â””â”€â”€ latest.txt                     # Ğ£ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ÑŒ
â”‚
â””â”€â”€ locks/
    â”œâ”€â”€ module_vedomost1.lock.json
    â”œâ”€â”€ module_vedomost2.lock.json
    â”œâ”€â”€ module_aid.lock.json
    â””â”€â”€ admin.lock.json                    # ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ Ğ½Ğ°Ğ´ Ğ²ÑĞµĞ¼
```

---

## 5. Event Log Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ (Per-User Files)

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ½Ğµ Ğ¾Ğ´Ğ¸Ğ½ Ñ„Ğ°Ğ¹Ğ»:**
- ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² Ğ¾Ğ´Ğ¸Ğ½ Ñ„Ğ°Ğ¹Ğ» Ğ½Ğ° SMB â†’ ÑĞ¼ĞµÑˆĞ°Ğ½Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸, Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ JSON
- Ğ‘ÑƒÑ„ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ SMB Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¸ÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ² ÑĞ²Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»**

```
\\server\share\Structura\sync\events\
â”œâ”€â”€ events-ivanov.jsonl          â† Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ² Ğ¿Ğ¸ÑˆĞµÑ‚ ÑÑĞ´Ğ°
â”œâ”€â”€ events-petrov.jsonl          â† Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞŸĞµÑ‚Ñ€Ğ¾Ğ² Ğ¿Ğ¸ÑˆĞµÑ‚ ÑÑĞ´Ğ°
â””â”€â”€ events-admin.jsonl           â† Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ°Ğ´Ğ¼Ğ¸Ğ½ Ğ¿Ğ¸ÑˆĞµÑ‚ ÑÑĞ´Ğ°
```

**Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ:**
```json
{"ts":"2026-01-28T14:30:00.123Z","seq":1,"user":"ivanov","action":"update","table":"elements","id":"abc123","data":{...}}
```
- `ts` â€” timestamp Ñ Ğ¼Ğ¸Ğ»Ğ»Ğ¸ÑĞµĞºÑƒĞ½Ğ´Ğ°Ğ¼Ğ¸
- `seq` â€” Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ sequence number (Ğ´Ğ»Ñ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞ° Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ)
- `user` â€” ĞºÑ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ» Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ

**Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:**
```typescript
async function syncFromEventLog(lastSyncTs: string): Promise<void> {
    const eventsDir = '\\\\server\\share\\Structura\\sync\\events';
    const allEvents: Event[] = [];
    
    // 1. ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ’Ğ¡Ğ• Ñ„Ğ°Ğ¹Ğ»Ñ‹ events-*.jsonl
    for (const file of fs.readdirSync(eventsDir)) {
        if (!file.startsWith('events-') || !file.endsWith('.jsonl')) continue;
        
        const lines = fs.readFileSync(path.join(eventsDir, file), 'utf-8').split('\n');
        for (const line of lines) {
            if (!line.trim()) continue;
            const event = JSON.parse(line);
            if (event.ts > lastSyncTs) {
                allEvents.push(event);
            }
        }
    }
    
    // 2. Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ ts, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ¿Ğ¾ seq
    allEvents.sort((a, b) => {
        const tsCmp = a.ts.localeCompare(b.ts);
        if (tsCmp !== 0) return tsCmp;
        return a.seq - b.seq;
    });
    
    // 3. ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğº Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ SQLite
    for (const event of allEvents) {
        applyEvent(event);
    }
    
    // 4. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ lastSyncTs
    updateLastSyncTs(allEvents[allEvents.length - 1]?.ts || lastSyncTs);
}
```

**Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ:**
```typescript
function appendEvent(event: Partial<Event>): void {
    const eventsDir = '\\\\server\\share\\Structura\\sync\\events';
    const myFile = path.join(eventsDir, `events-${currentUser}.jsonl`);
    
    const fullEvent = {
        ts: new Date().toISOString(),
        seq: getNextSeq(),
        user: currentUser,
        ...event
    };
    
    fs.appendFileSync(myFile, JSON.stringify(fullEvent) + '\n');
}
```

**Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
1. ĞŸÑ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… â†’ append Ğ² `events-<user>.jsonl`
2. ĞŸÑ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ â†’ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ’Ğ¡Ğ• Ñ„Ğ°Ğ¹Ğ»Ñ‹, Ğ¾Ñ‚Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
3. Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ ts+seq Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğº Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ SQLite

---

## 5.1 Snapshots

**Ğ—Ğ°Ñ‡ĞµĞ¼:** Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ½Ğµ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ²ĞµÑÑŒ event log)

```
\\server\share\Structura\sync\snapshots\
â”œâ”€â”€ snapshot-20260128-143000.zip
â”‚   â”œâ”€â”€ structura.db             â† SQLite Ğ±Ğ°Ğ·Ğ°
â”‚   â””â”€â”€ manifest.json            â† ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
â””â”€â”€ latest.txt                   â† Ğ£ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ snapshot
```

**manifest.json:**
```json
{
    "created_at": "2026-01-28T14:30:00Z",
    "created_by": "admin",
    "last_event_ts": "2026-01-28T14:29:55.123Z",
    "db_size_bytes": 1234567,
    "events_applied": 4523
}
```

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**
1. ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ â†’ ÑĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ snapshot
2. Ğ Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² `%LOCALAPPDATA%\Structura\data\`
3. ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¿Ğ¾ÑĞ»Ğµ `last_event_ts`
4. ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğº Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ‘Ğ”

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ snapshot (Ğ°Ğ´Ğ¼Ğ¸Ğ½):**
```typescript
async function createSnapshot(): Promise<void> {
    const snapshotsDir = '\\\\server\\share\\Structura\\sync\\snapshots';
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    const zipName = `snapshot-${timestamp}.zip`;
    
    // 1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ event log
    const lastEventTs = getLastEventTs();
    
    // 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ZIP Ñ Ğ‘Ğ” Ğ¸ manifest
    const zip = new AdmZip();
    zip.addLocalFile(path.join(LOCAL_DATA, 'structura.db'));
    zip.addFile('manifest.json', Buffer.from(JSON.stringify({
        created_at: new Date().toISOString(),
        created_by: currentUser,
        last_event_ts: lastEventTs,
        // ...
    })));
    
    // 3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ
    zip.writeZip(path.join(snapshotsDir, zipName));
    
    // 4. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ latest.txt
    fs.writeFileSync(path.join(snapshotsDir, 'latest.txt'), zipName);
}

---

## 6. Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ‘Ğ” (better-sqlite3)

**ĞŸÑƒÑ‚ÑŒ:** `%LOCALAPPDATA%\Structura\data\structura.db`

```sql
-- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºÑÑˆ)
CREATE TABLE users (
    id TEXT PRIMARY KEY,
    username TEXT UNIQUE,
    display_name TEXT,
    role TEXT CHECK(role IN ('user', 'admin'))
);

-- ĞŸÑ€Ğ¾ĞµĞºÑ‚Ñ‹
CREATE TABLE projects (
    id TEXT PRIMARY KEY,
    speckle_stream_id TEXT,
    name TEXT,
    current_commit_id TEXT,
    last_synced_at DATETIME
);

-- Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
CREATE TABLE elements (
    guid TEXT PRIMARY KEY,
    project_id TEXT,
    name TEXT,
    status TEXT,
    assigned_module TEXT,
    modified_by TEXT,
    modified_at DATETIME,
    local_version INTEGER DEFAULT 0
);

-- ĞĞºÑ‚Ñ‹
CREATE TABLE acts (
    id TEXT PRIMARY KEY,
    project_id TEXT,
    name TEXT,
    pdf_path TEXT,
    created_by TEXT,
    created_at DATETIME
);

-- Ğ¡Ğ²ÑĞ·Ğ¸ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚-Ğ°ĞºÑ‚
CREATE TABLE element_acts (
    element_guid TEXT,
    act_id TEXT,
    linked_by TEXT,
    linked_at DATETIME,
    PRIMARY KEY (element_guid, act_id)
);

-- Ğ›Ğ¾Ğ³ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
CREATE TABLE sync_state (
    id INTEGER PRIMARY KEY CHECK(id = 1),
    last_event_ts TEXT,
    last_sync_at DATETIME
);
```

---

## 6.1 Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Native ĞœĞ¾Ğ´ÑƒĞ»ĞµĞ¹ (better-sqlite3 + Electron)

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:**
- `better-sqlite3` â€” Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ (C++ Ğ±Ğ¸Ğ½Ğ´Ğ¸Ğ½Ğ³Ğ¸ Ğº SQLite)
- Ğ‘Ğ¸Ğ½Ğ°Ñ€ÑŒ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½ Ğº Ğ²ĞµÑ€ÑĞ¸Ğ¸ Electron, Node ABI, Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğµ
- Electron 40 = Node 22.x ABI â†’ Ğ½ÑƒĞ¶ĞµĞ½ rebuild

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**

```json
// package.json (electron-builder config)
{
  "build": {
    "npmRebuild": true
  }
}
```

**Ğ˜Ğ»Ğ¸ ÑĞ²Ğ½Ğ¾ Ğ¿Ñ€Ğ¸ ÑĞ±Ğ¾Ñ€ĞºĞµ:**
```bash
npx electron-builder install-app-deps
```

**Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚:**
1. Ğ¡ĞºĞ°Ñ‡Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¸ Electron 40
2. `better-sqlite3` Ğ¿ĞµÑ€ĞµÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ´ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğ¹ ABI
3. Ğ‘Ğ¸Ğ½Ğ°Ñ€ÑŒ ÑƒĞ¿Ğ°ĞºĞ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ² portable-Ğ²ĞµÑ€ÑĞ¸Ñ

**Ğ’Ğ°Ğ¶Ğ½Ğ¾:**
- âœ… Rebuild Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ½Ğ° Ğ¼Ğ°ÑˆĞ¸Ğ½Ğµ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°/CI
- âœ… ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼ admin-Ğ¿Ñ€Ğ°Ğ²Ğ° ĞĞ• Ğ½ÑƒĞ¶Ğ½Ñ‹
- âœ… Ğ­Ñ‚Ğ¾ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ°Ñ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ° Ğ´Ğ»Ñ 90% Electron-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ native Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸

---

## 6.2 Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:**
- Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ğ°ÑÑ‚ Ğ¾Ñ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- ĞĞ¾ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ:
  - ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ 1: Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ» ÑÑ‚Ğ°Ñ‚ÑƒÑ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°
  - ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ 2: Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ» Ğ°ĞºÑ‚ Ğº ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ¶Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñƒ

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼**

| ĞœĞ¾Ğ´ÑƒĞ»ÑŒ | Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹/Ğ¿Ğ¾Ğ»Ñ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ |
|--------|----------------------------------|
| **Ğ’ĞµĞ´Ğ¾Ğ¼Ğ¾ÑÑ‚ÑŒ 1** | `elements.status`, `elements.data_vedomost1` |
| **Ğ’ĞµĞ´Ğ¾Ğ¼Ğ¾ÑÑ‚ÑŒ 2** | `elements.data_vedomost2` |
| **ĞĞ˜Ğ”** | `elements.aid_status`, `element_acts.*` |
| **ĞĞºÑ‚Ñ‹** | `acts.*` |

**ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿:** ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¸ Ğ¿Ğ¾Ğ»Ñ.

**Conflict Resolver (fallback):**

Ğ•ÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµÑĞµÑ‡ĞµĞ½Ğ¸Ñ Ğ²ÑÑ‘ Ğ¶Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹ â€” **last write wins** Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ¼:

```typescript
function applyEvent(event: Event): void {
    const existingTs = db.prepare('SELECT modified_at FROM elements WHERE guid = ?')
        .get(event.id)?.modified_at;
    
    if (existingTs && existingTs > event.ts) {
        // ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚: Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ¾Ğ²ĞµĞµ
        logConflict({
            table: event.table,
            id: event.id,
            localTs: existingTs,
            eventTs: event.ts,
            eventUser: event.user,
            resolution: 'skipped (local is newer)'
        });
        return;
    }
    
    // ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ
    applyChange(event);
}
```

**Ğ›Ğ¾Ğ³ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ²:**
```sql
CREATE TABLE conflict_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    occurred_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    table_name TEXT,
    record_id TEXT,
    local_ts TEXT,
    event_ts TEXT,
    event_user TEXT,
    resolution TEXT
);
```

**Ğ’Ğ°Ğ¶Ğ½Ğ¾:**
- ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ñ‹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ñ€ĞµĞ´ĞºĞ¸Ğ¼Ğ¸ (ĞµÑĞ»Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸)
- Ğ›Ğ¾Ğ³ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ¸
- ĞĞ´Ğ¼Ğ¸Ğ½ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ¸ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾

---

## 7. Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ´Ğ»Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 1: Launcher
```
Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ StructuraLauncher.exe:
- Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ current_version.txt Ğ¸Ğ· ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹ Ğ¿Ğ°Ğ¿ĞºĞ¸
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ update.lock (exclusive mode, retry Ñ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚Ğ¾Ğ¼)
- ĞÑ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾Ğµ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: â†’ tmp â†’ rename
- Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ local_version.txt Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Structura.exe
- ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸
- Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ²ĞµÑ€ÑĞ¸Ğ¸ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
```

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 2: Cache Fetcher (ĞĞ´Ğ¼Ğ¸Ğ½)
```
Ğ’ Electron main ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ CacheModel(streamId, commitId):
- ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ referencedObject id Ñ‡ĞµÑ€ĞµĞ· GraphQL
- Ğ§ĞµÑ€ĞµĞ· @speckle/objectloader ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ²ÑĞµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹
- ĞŸĞ¸ÑˆĞµÑ‚ Ğ² model-cache/<streamId>/<commitId>/
- ĞŸĞ¸ÑˆĞµÑ‚ manifest.json (Ñ€Ğ°Ğ·Ğ¼ĞµÑ€, Ğ´Ğ°Ñ‚Ğ°, ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²)
- Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
```

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 3: Custom Loader Ğ´Ğ»Ñ Viewer
```
Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ»Ğ°ÑÑ LocalCacheLoader:
- Extends Loader Ğ¸Ğ· @speckle/viewer
- Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· model-cache/
- Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ WorldTree
- ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ†ĞµĞ»ÑŒ: Ğ³ĞµĞ¾Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ÑÑ offline
- Ğ•ÑĞ»Ğ¸ ĞºÑÑˆĞ° Ğ½ĞµÑ‚ â†’ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°
```

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 4: Proxy Feasibility Test
```
Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº URL ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ´ĞµÑ€Ğ³Ğ°ĞµÑ‚ SpeckleLoader:
- Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ DevTools Network Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
- Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğº Speckle ÑĞµÑ€Ğ²ĞµÑ€Ñƒ
- ĞÑ†ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾ ÑĞ¼ÑƒĞ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
- Ğ’Ñ‹Ğ²Ğ¾Ğ´: proxy Ğ¿Ñ€Ğ¾Ñ‰Ğµ Ğ¸Ğ»Ğ¸ custom loader
```

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 5: Lock-Ñ„Ğ°Ğ¹Ğ»Ñ‹
```
Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹:
- ĞÑ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· rename-Ñ‚Ñ€ÑĞº (tmp â†’ rename)
- Heartbeat ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 15-20 ÑĞµĞº
- Grace window 90 ÑĞµĞº (Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ»Ğ°Ğ³Ğ° ÑĞµÑ‚Ğ¸)
- ĞŸÑ€Ğ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğµ â†’ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ
- admin.lock.json â†’ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ Ğ½Ğ°Ğ´ Ğ²ÑĞµĞ¼ (Ğ²ÑĞµ read-only)
```

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 6: Event Log ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Per-User Files)
```
- ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ² ÑĞ²Ğ¾Ğ¹ events-<user>.jsonl
- ĞŸÑ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ â†’ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ’Ğ¡Ğ• Ñ„Ğ°Ğ¹Ğ»Ñ‹ events-*.jsonl
- Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ ts + seq
- ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğº Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ SQLite
- Snapshot ĞºĞ°Ğº ZIP (db + manifest) Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ ÑÑ‚Ğ°Ñ€Ñ‚Ğ°
```

---

## 8. ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

| Ğ­Ñ‚Ğ°Ğ¿ | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ | Ğ’Ñ€ĞµĞ¼Ñ |
|------|--------|-------|
| **1. Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°** | Launcher, ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ğ°Ğ¿Ğ¾Ğº | 1 Ğ´ĞµĞ½ÑŒ |
| **2. Speckle POC** | Cache Fetcher, Custom Loader / Proxy test | 2-3 Ğ´Ğ½Ñ |
| **3. Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ‘Ğ”** | Schema, CRUD, better-sqlite3 | 1 Ğ´ĞµĞ½ÑŒ |
| **4. Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** | Event log, snapshot, apply | 2 Ğ´Ğ½Ñ |
| **5. Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸** | Lock-Ñ„Ğ°Ğ¹Ğ»Ñ‹, heartbeat | 0.5 Ğ´Ğ½Ñ |
| **6. ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ UI** | FullViewer + panels Ğ¸Ğ· ÑÑ‚Ğ°Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° | 1-2 Ğ´Ğ½Ñ |
| **7. Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ** | Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ Ğ²ÑÑ‘ Ğ²Ğ¼ĞµÑÑ‚Ğµ | 1-2 Ğ´Ğ½Ñ |
| **8. Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** | 2 Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ, offline, locks | 1 Ğ´ĞµĞ½ÑŒ |

**Ğ˜Ñ‚Ğ¾Ğ³Ğ¾:** 10-13 Ğ´Ğ½ĞµĞ¹

---

## 9. ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ· Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑĞ°

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | ĞŸÑƒÑ‚ÑŒ | Ğ¡Ñ‚Ñ€Ğ¾Ğº |
|-----------|------|-------|
| FullViewer | `src/components/FullViewer/FullViewer.tsx` | ~1000 |
| ViewerToolbar | `src/components/FullViewer/panels/ViewerToolbar.tsx` | ~100 |
| MeasurementsPanel | `panels/MeasurementsPanel.tsx` | ~200 |
| FilterPanel | `panels/FilterPanel.tsx` | ~500 |
| SceneExplorerPanel | `panels/SceneExplorerPanel.tsx` | ~400 |
| ModelsPanel | `panels/ModelsPanel.tsx` | ~400 |
| SelectInfoPanel | `panels/SelectInfoPanel.tsx` | ~700 |

### Ğ§Ñ‚Ğ¾ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

1. **SpeckleLoader â†’ LocalCacheLoader** (Ğ´Ğ»Ñ offline)
2. Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğº ÑĞµÑ€Ğ²ĞµÑ€Ñƒ Ğ¸Ğ· UI
3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ¿ĞµÑ€ĞµĞ´ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼
4. ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½ÑƒÑ SQLite Ğ²Ğ¼ĞµÑÑ‚Ğ¾ server API

---

## 10. ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ

**Ğ—Ğ°Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ:**

- âœ… Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ SQLite Ñƒ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ + Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ event log (Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ A1)
- âœ… Launcher Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ±ĞµĞ· ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸
- âœ… Lock-Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
- âœ… Custom Loader Ğ´Ğ»Ñ Speckle offline (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¿ÑƒÑ‚ÑŒ)
- âœ… Proxy ĞºĞ°Ğº backup Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ°
- âœ… ĞœĞ¾Ğ´ĞµĞ»ÑŒ ~200 MB

**Ğ“Ğ¾Ñ‚Ğ¾Ğ² Ğº Ğ½Ğ°Ñ‡Ğ°Ğ»Ñƒ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸.**
